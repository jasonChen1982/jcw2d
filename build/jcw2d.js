!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(){return t.JC=e()}):t.JC=e()}(this,function(){function t(t){return Object.prototype.toString.call(t)}function e(){this.global={x:-1e5,y:-1e5},this.target=null,this.originalEvent=null,this.cancleBubble=!1,this.ratio=1,this.type=""}function i(){this.touchstarted=!1,this.mouseDowned=!1,this.listeners={}}function r(t){this.element=t.element||{},this.duration=t.duration||300,this.living=!0,this.onCompelete=t.onCompelete||null,this.onUpdate=t.onUpdate||null,this.infinity=t.infinity||!1,this.alternate=t.alternate||!1,this.ease=t.ease||"easeBoth",this.repeats=t.repeats||0,this.delay=t.delay||0,this.progress=0-this.delay,this.timeScale=t.timeScale||1,this.paused=!1}function s(t){S.Animate.call(this,t),this.ATRS=t.from,this.ATRE=t.to}function o(t){S.Animate.call(this,t),this._keyframes=t.keys,this._keyIndex=0,this._direction=1,this._keyConfig=t.keyConfig,this.configKey()}function n(t,e){this.element=t,this.living=!1,this.onCompelete=null,this.infinity=!1,this.alternate=!1,this.repeats=0,this.animations=e.animations||{},this.index=0,this.direction=1,this.frames=[],this.sy=e.sy||0,this.sx=e.sx||0,this.fillMode=0,this.fps=16,this.paused=!1,this.pt=0,this.nt=0}function a(t){S.Animate.call(this,t),this.points=t.points,this.attachNormal=t.attachNormal||!1,this.sDeg=!1,this.tDeg=0,this.pDeg=0}function h(){this.start=!1,this.animates=[]}function c(t,e){this.x=t||0,this.y=e||0}function p(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0}function u(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}function d(t,e){S.Eventer.call(this),this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=e||S.CONST.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.resolution=1,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=!1,t&&this.loadSource(t)}function l(t,e){S.Eventer.call(this),this.noFrame=!1,e||(this.noFrame=!0,e=new S.Rectangle(0,0,1,1)),t instanceof l&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,t.hasLoaded?(this.noFrame&&(e=new S.Rectangle(0,0,t.width,t.height),t.on("update",this.onBaseTextureUpdated.bind(this))),this.frame=e):t.once("loaded",this.onBaseTextureLoaded.bind(this))}function f(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1}function y(){this._ready=!0,this.visible=!0,this.worldAlpha=1,this.alpha=1,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.rotation=0,this.rotationCache=0,this._sr=0,this._cr=1,this.x=0,this.y=0,this.pivotX=0,this.pivotY=0,this.mask=null,this.parent=null,this.worldTransform=new S.Matrix,this.event=new S.Eventer,this.passEvent=!1,this.bounds=[],this.Animator=new S.Animator}function m(){S.DisplayObject.call(this),this.cds=[],this.timeScale=1,this.paused=!1}function g(t){S.Container.call(this),this._ready=!1,this.regX=0,this.regY=0,this._texture=null,this.tint=16777215,this.blendMode=S.CONST.BLEND_MODES.NORMAL,this.shaderType="sprite",this.cachedTint=16777215,this.cachedAlpha=this.alpha,this.vertices=null,this.indices=new Uint16Array([0,1,2,0,2,3]),this.colors=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.indexBuffer=null,this.texture=t,this.update=!1}function v(t,e,i){S.Container.call(this),i=i||15e3,t=t||15e3;var r=16384;i>r&&(i=r),i>t&&(i=t),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=i,this._buffers=null,this._bufferToUpdate=0,this.interactiveChildren=!1,this.blendMode=S.CONST.BLEND_MODES.NORMAL,this.setProperties(e)}function T(t,e){if(e=e||{})for(var i in S.CONST.DEFAULT_RENDER_OPTIONS)"undefined"==typeof e[i]&&(e[i]=S.CONST.DEFAULT_RENDER_OPTIONS[i]);else e=S.CONST.DEFAULT_RENDER_OPTIONS;this.view="string"!=typeof t?t:document.getElementById(t),this.width=this.view.width,this.height=this.view.height,this.projection=new Float32Array([this.width>>1,this.height>>1]),this.resolution=e.resolution,this.transparent=e.transparent,this.autoResize=e.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.autoClear=e.autoClear,this._backgroundColor=0,this._backgroundColorRgb=[0,0,0],this._backgroundColorString="#000000",this.backgroundColor=e.backgroundColor||this._backgroundColor,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._contextOptions={alpha:this.transparent,antialias:e.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer},this.event=new S.Eventer,this._createContext(),this._initContext(),this._mapGlModes(),this.shaderManager=new S.ShaderManager(this),this.blendModeManager=new S.BlendModeManager(this),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this._tempDisplayObjectParent={worldTransform:S.IDENTITY,worldAlpha:1,children:[]},this.pt=-1,this.timeScale=1}function x(t){this.renderer=t,this.shaderType="",this.currentShader=null,this.init()}function _(t){this.renderer=t,this.currentBlendMode=99999}function b(t,e,i,r,s){if(!e||!i)throw new Error("jcw2d.js Error. Shader requires vertexSrc and fragmentSrc");this.type="",this.gl=t,this.program=null,this.uniforms=r||{},this.attributes=s||{},this.textureCount=1,this.MAX_TEXTURE_UNITS=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.vertexSrc=e,this.fragmentSrc=i,this.init()}function E(t){var e={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])},projectionVector:{type:"2fv",value:new Float32Array([1,1])}},i={aVertexPosition:{size:2},aTextureCoord:{size:2},aColor:{size:4}},r=["precision highp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy / projectionVector, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),s=["precision highp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"].join("\n");b.call(this,t,r,s,e,i)}function A(t){var e={uAlpha:{type:"1f",value:1},uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])},projectionVector:{type:"2fv",value:new Float32Array([1,1])}},i={aVertexPosition:0,aTextureCoord:0,aAlpha:0,aPositionCoord:0,aRotation:0},r=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aAlpha;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vAlpha;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy / projectionVector, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vAlpha = aAlpha;","}"].join("\n"),s=["precision lowp float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vAlpha * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n");b.call(this,t,r,s,e,i)}function w(t){b.call(this,t,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec2 projectionVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy / projectionVector, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},projectionMatrix:{type:"mat3",value:new Float32Array(9)},projectionVector:{type:"2fv",value:new Float32Array([1,1])}},{aVertexPosition:0,aColor:0})}var S=window.JC||{};return function(){for(var t=0,e=(/(?=.*?uc)(?=.*?android)/i.test(window.navigator.userAgent),["ms","moz","webkit","o"]),i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),r=Math.max(0,20-(i-t)),s=window.setTimeout(function(){e(i+r)},r);return t=i+r,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.RAF=window.requestAnimFrame=window.requestAnimationFrame}(),S.CONST={VERSION:"0.0.1",PI_2:2*Math.PI,RTD:180/Math.PI,DTR:Math.PI/180,BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!0,autoResize:!1,transparent:!1,backgroundColor:0,autoClear:!0,preserveDrawingBuffer:!1},SPRITE_BATCH_SIZE:2e3},S.UTILS={hex2rgb:function(t,e){return e=e||[],e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},hex2string:function(t){return t=t.toString(16),t="000000".substr(0,6-t.length)+t,"#"+t},rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},getNextPowerOfTwo:function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},isPowerOfTwo:function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},sayHi:function(t){if(!this._saidHi){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["\n %c %c %c jcw2d.js "+S.CONST.VERSION+" - ✰ "+t+" ✰  %c  %c  http://www.jason82.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,e)}else window.console&&window.console.log("jcw2d.js "+S.CONST.VERSION+" - "+t+" - http://www.jason82.com/");this._saidHi=!0}},isWebGLSupported:function(){var t={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);return!(!i||!i.getContextAttributes().stencil)}catch(r){return!1}},sign:function(t){return t?t<0?-1:1:0},removeItems:function(t,e,i){var r=t.length;if(!(e>=r||0===i)){i=e+i>r?r-e:i;for(var s=e,o=r-i;s<o;++s)t[s]=t[s+i];t.length=o}},copyJSON:function(t){return JSON.parse(JSON.stringify(t))},isArray:function(){var e=t("s");return function(t){return Object.prototype.toString.call(t)===e}}(),isObject:function(){var e=t({});return function(t){return Object.prototype.toString.call(t)===e}}(),isNumber:function(){var e=t(1);return function(t){return Object.prototype.toString.call(t)===e}}(),isFunction:function(){var e=t(function(){});return function(t){return Object.prototype.toString.call(t)===e}}(),random:function(t,e){return this.isArray(t)?t[~~(Math.random()*t.length)]:(this.isNumber(e)||(e=t||1,t=0),t+Math.random()*(e-t))},euclideanModulo:function(t,e){return(t%e+e)%e},clamp:function(t,e,i){return t<e?e:t>i?i:t},TextureCache:{},BaseTextureCache:{}},S.TWEEN={easeBoth:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},extend:function(t){if(t)for(var e in t)"extend"!==e&&t[e]&&(this[e]=t[e])}},S.InteractionData=e,i.prototype.on=function(t,e){this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)},i.prototype.off=function(t,e){var i=this.listeners,r=i[t],s=i[t].length;if(r&&s>0)if(e)for(;s--;)r[s]===e&&r.splice(s,1);else r.length=0},i.prototype.once=function(t,e){var i=this,r=function(s){e&&e(s),i.off(t,r)};this.on(t,r)},i.prototype.emit=function(t){if(void 0!==this.listeners){var e=this.listeners,i=e[t.type];if(void 0!==i){var r,s=i.length;for(r=0;r<s;r++)i[r].call(this,t)}}},S.Eventer=i,S.Animate=r,r.prototype.nextPose=function(){var t={};for(var e in this.ATRE)t[e]=S.TWEEN[this.ease](this.progress,this.ATRS[e],this.ATRE[e]-this.ATRS[e],this.duration),void 0!==this.element[e]&&(this.element[e]=t[e]);return t},r.prototype.pause=function(){this.paused=!0},r.prototype.start=function(){this.paused=!1},r.prototype.stop=function(){this.progress=this.duration},r.prototype.cancle=function(){this.living=!1},S.Transition=s,s.prototype=Object.create(S.Animate.prototype),s.prototype.constructor=S.Transition,s.prototype.update=function(t){if(!this.paused&&this.living)if(this.progress+=this.timeScale*t,this.progress<this.duration){if(this.progress<0)return;var e=this.nextPose();this.onUpdate&&this.onUpdate(e,this.progress/this.duration)}else if(this.element.setVal(this.ATRE),this.onUpdate&&this.onUpdate(this.ATRE,1),this.repeats>0||this.infinity)if(this.repeats>0&&--this.repeats,this.progress=0,this.alternate){var i=S.UTILS.copyJSON(this.ATRS);this.ATRS=S.UTILS.copyJSON(this.ATRE),this.ATRE=i}else this.element.setVal(this.ATRS);else this.living=!1,this.onCompelete&&this.onCompelete()},S.Animation=o,o.prototype=Object.create(S.Animate.prototype),o.prototype.constructor=S.Animation,o.prototype.configKey=function(){this.ATRS=this._keyframes[this._keyIndex],this._keyIndex+=this._direction,this.ATRE=this._keyframes[this._keyIndex];var t=this._keyConfig[Math.min(this._keyIndex,this._keyIndex-this._direction)]||{};this.ease=t.ease||this.ease,this.duration=t.duration||this.duration,this.progress=0},o.prototype.update=function(t){if(!this.paused&&this.living)if(this.progress+=this.timeScale*t,this.progress<this.duration){if(this.progress<0)return;var e=this.nextPose();this.onUpdate&&this.onUpdate(e,this.progress/this.duration,this._keyIndex)}else this.element.setVal(this.ATRE),this.onUpdate&&this.onUpdate(this.ATRE,1,this._keyIndex),this._keyIndex<this._keyframes.length-1&&this._keyIndex>0?this.configKey():this.repeats>0||this.infinity?(this.repeats>0&&--this.repeats,this.alternate?this._direction*=-1:this._keyIndex=0,this.configKey()):(this.living=!1,this.onCompelete&&this.onCompelete())},S.MovieClip=n,n.prototype.update=function(t){if(!this.paused&&this.living&&(this.nt+=t,!(this.nt-this.pt<this.interval))){this.pt=this.nt;var e=this.index+this.direction;e<this.frames.length&&e>=0?this.index=e:this.repeats>0||this.infinity?(this.repeats>0&&--this.repeats,this.alternate?(this.direction*=-1,this.index+=this.direction):(this.direction=1,this.index=0)):(this.living=!1,this.index=this.fillMode,this.onCompelete&&this.onCompelete(),this.next&&this.next())}},n.prototype.getFramePos=function(){var t={x:this.sx,y:this.sy},e=this.frames[this.index];if(e>0){var i=this.element._textureW/this.element.width>>0,r=this.sx/this.element.width>>0,s=this.sy/this.element.height>>0,o=s+(r+e)/i>>0,n=(r+e)%i;t.x=n*this.element.width,t.y=o*this.element.height}return t},n.prototype.playMovie=function(t){this.next=null;var e=this.format(t.movie);S.isArray(e)&&(this.frames=e,this.index=0,this.direction=1,this.fillMode=t.fillMode||0,this.fps=t.fps||this.fps,this.infinity=t.infinity||!1,this.alternate=t.alternate||!1,this.repeats=t.repeats||0,this.living=!0,this.onCompelete=t.onCompelete||null)},n.prototype.format=function(t){if(S.isString(t)){var e=this.animations[t];return e?this.format(e):(console.warn("%c JC.MovieClip warn %c: you didn`t config %c"+t+"%c in animations ","color: #f98165; background: #80a89e","color: #80a89e; background: #cad9d5;","color: #f98165; background: #cad9d5","color: #80a89e; background: #cad9d5"),!1)}if(S.isArray(t))return t;if(S.isObject(t)){for(var i=[],r=t.start;r<=t.end;r++)i.push(r);if(t.next&&this.animations[t.next]){var s=this;this.next=function(){s.playMovie({movie:this.animations[t.next],infinity:!0})}}return i}},n.prototype.pause=function(){this.paused=!0},n.prototype.start=function(){this.paused=!1},n.prototype.cancle=function(){this.living=!1},Object.defineProperty(n.prototype,"interval",{get:function(){return this.fps>0?1e3/this.fps>>0:16}}),S.PathMotion=a,a.prototype=Object.create(S.Animate.prototype),a.prototype.constructor=S.PathMotion,a.prototype.update=function(t){if(!this.paused&&this.living)if(this.progress+=this.timeScale*t,this.progress<this.duration){if(this.progress<0)return;var e=this.nextPose();this.onUpdate&&this.onUpdate(e,this.progress/this.duration)}else if(this.element.setVal(this.ATRE),this.onUpdate&&this.onUpdate(this.ATRE,1),this.repeats>0||this.infinity)if(this.repeats>0&&--this.repeats,this.progress=0,this.alternate){var i=S.UTILS.copyJSON(this.ATRS);this.ATRS=S.UTILS.copyJSON(this.ATRE),this.ATRE=i}else this.element.setVal(this.ATRS);else this.living=!1,this.onCompelete&&this.onCompelete()},a.prototype.nextPose=function(){var t={},e=S.TWEEN[this.ease](this.progress,0,1,this.duration),i=this.getPoint(e,this.points);return t.x=i.x,t.y=i.y,this.attachNormal&&(t.rotate=this.decomposeRotate(e)),t},a.prototype.getPoint=function(t,e){var i=e,r=i.length,s=1-t,o=i.slice(0,r-1),n=i.slice(1),a={};if(r>3){var h=this.getPoint(t,o),c=this.getPoint(t,n);return a.x=s*h.x+t*c.x,a.y=s*h.y+t*c.y,a}return a.x=s*s*e[0].x+2*t*s*e[1].x+t*t*e[2].x,a.y=s*s*e[0].y+2*t*s*e[1].y+t*t*e[2].y,a},a.prototype.decomposeRotate=function(t){var e=this.getPoint(t,this.points),i=this.getPoint(t+.01,this.points);e.xxxxx+i.x},S.Animator=h,h.prototype.update=function(t){for(var e=0;e<this.animates.length;e++)this.animates[e].living||this.animates.splice(e,1),this.animates[e]&&this.animates[e].update(t)},h.prototype.fromTo=function(t){var e=new S.Transition(t);return this.animates.push(e),e},h.prototype.keyFrames=function(t){var e=new S.Animation(t);return this.animates.push(e),e},S.Point=c,c.prototype.constructor=S.Point,c.prototype.clone=function(){return new c(this.x,this.y)},c.prototype.copy=function(t){this.set(t.x,t.y)},c.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},c.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},S.Rectangle=p,p.prototype.constructor=S.Rectangle,p.EMPTY=new p(0,0,0,0),p.prototype.clone=function(){return new p(this.x,this.y,this.width,this.height)},p.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},S.Matrix=u,u.prototype.constructor=S.Matrix,u.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},u.prototype.toArray=function(t){this.array||(this.array=new Float32Array(9));var e=this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},u.prototype.apply=function(t,e){return e=e||{},e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},u.prototype.applyInverse=function(t,e){var i=1/(this.a*this.d+this.c*-this.b);return e.x=this.d*i*t.x+-this.c*i*t.y+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*t.y+-this.b*i*t.x+(-this.ty*this.a+this.tx*this.b)*i,e},u.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},u.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},u.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,o=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},u.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,s=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},u.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},u.prototype.setTransform=function(t,e,i,r,s,o,n,a,h){var c,p,u,d,l,f,y,m,g,v;return l=Math.sin(n),f=Math.cos(n),y=Math.cos(h),m=Math.sin(h),g=-Math.sin(a),v=Math.cos(a),c=f*s,p=l*s,u=-l*o,d=f*o,this.a=y*c+m*u,this.b=y*p+m*d,this.c=g*c+v*u,this.d=g*p+v*d,this.tx=t+(i*c+r*u),this.ty=e+(i*p+r*d),this},S.IDENTITY=new u,S.TEMP_MATRIX=new u,d.prototype=Object.create(S.Eventer.prototype),d.prototype.constructor=d,d.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=S.UTILS.isPowerOfTwo(this.realWidth,this.realHeight),this.emit({type:"update"})},d.prototype.loadSource=function(t){var e=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,this.source=t,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!t.getContext){this.isLoading=!0;var i=this;t.onload=function(){t.onload=null,t.onerror=null,i.isLoading=!1,i._sourceLoaded(),i.emit({type:"loaded"})},t.onerror=function(){t.onload=null,t.onerror=null,i.isLoading=!1,i.emit({type:"error"})},t.complete&&t.src&&(this.isLoading=!1,t.onload=null,t.onerror=null,t.width&&t.height?(this._sourceLoaded(),e&&this.emit({type:"loaded"})):e&&this.emit({type:"error"}))}},d.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},d.fromImage=function(t,e,i){var r=S.UTILS.BaseTextureCache[t];if(void 0===e&&0!==t.indexOf("data:")&&(e=!0),!r){var s=new Image;e&&(s.crossOrigin=""),r=new d(s,i),r.imageUrl=t,s.src=t,S.UTILS.BaseTextureCache[t]=r}return r},S.Texture=l,l.prototype=Object.create(S.Eventer.prototype),l.prototype.constructor=l,Object.defineProperties(l.prototype,{frame:{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1,this.width=t.width,this.height=t.height,this.valid=t&&t.width&&t.height&&this.baseTexture.hasLoaded,this.valid&&this._updateUvs()}}}),l.prototype.update=function(){this.baseTexture.update()},l.prototype.onBaseTextureLoaded=function(){this.noFrame?this.frame=new S.Rectangle(0,0,this.baseTexture.width,this.baseTexture.height):this.frame=this._frame,this.emit({type:"loaded"})},l.prototype.onBaseTextureUpdated=function(){this._frame.width=this.baseTexture.width,this._frame.height=this.baseTexture.height,this.emit({type:"update"})},l.prototype._updateUvs=function(){this._uvs||(this._uvs=new f),this._uvs.set(this.frame,this.baseTexture)},l.fromImage=function(t,e,i){var r=S.UTILS.TextureCache[t];return r||(r=new l(d.fromImage(t,e,i)),S.UTILS.TextureCache[t]=r),r},l.fromCanvas=function(t,e){return new l(d.fromCanvas(t,e))},f.prototype.set=function(t,e){var i=e.width,r=e.height;this.x0=t.x/i,this.y0=t.y/r,this.x1=(t.x+t.width)/i,this.y1=t.y/r,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/r,this.x3=t.x/i,this.y3=(t.y+t.height)/r},f.prototype.get=function(){return new Float32Array([this.x0,this.y0,this.x1,this.y1,this.x2,this.y2,this.x3,this.y3])},S.DisplayObject=y,y.prototype.constructor=S.DisplayObject,Object.defineProperty(y.prototype,"scale",{get:function(){return this.scaleX},set:function(t){this.scaleX=this.scaleY=t}}),y.prototype.fromTo=function(t,e){return t.element=this,this.setVal(t.from),e&&(this.Animator.animates.length=0),this.Animator.fromTo(t)},y.prototype.to=function(t,e){t.element=this,t.from={};for(var i in t.to)t.from[i]=this[i];return e&&(this.Animator.animates.length=0),this.Animator.fromTo(t)},y.prototype.keyFrames=function(t,e){return t.element=this,e&&(this.Animator.animates.length=0),this.Animator.keyFrames(t)},y.prototype.isVisible=function(){return!!(this.visible&&this.alpha>0&&this.scaleX*this.scaleY>0)},y.prototype.setVal=function(t){if(void 0!==t)for(var e in t)void 0!==this[e]&&(this[e]=t[e])},y.prototype.updateMe=function(){var t,e,i,r,s,o,n=this.parent.worldTransform,a=this.worldTransform;this.skewX||this.skewY?(S.TEMP_MATRIX.setTransform(this.x,this.y,this.pivotX,this.pivotY,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY),a.a=S.TEMP_MATRIX.a*n.a+S.TEMP_MATRIX.b*n.c,a.b=S.TEMP_MATRIX.a*n.b+S.TEMP_MATRIX.b*n.d,a.c=S.TEMP_MATRIX.c*n.a+S.TEMP_MATRIX.d*n.c,a.d=S.TEMP_MATRIX.c*n.b+S.TEMP_MATRIX.d*n.d,a.tx=S.TEMP_MATRIX.tx*n.a+S.TEMP_MATRIX.ty*n.c+n.tx,a.ty=S.TEMP_MATRIX.tx*n.b+S.TEMP_MATRIX.ty*n.d+n.ty):this.rotation%360?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation*S.CONST.DTR),this._cr=Math.cos(this.rotation*S.CONST.DTR)),t=this._cr*this.scaleX,e=this._sr*this.scaleX,i=-this._sr*this.scaleY,r=this._cr*this.scaleY,s=this.x,o=this.y,(this.pivotX||this.pivotY)&&(s-=this.pivotX*t+this.pivotY*i,o-=this.pivotX*e+this.pivotY*r),a.a=t*n.a+e*n.c,a.b=t*n.b+e*n.d,a.c=i*n.a+r*n.c,a.d=i*n.b+r*n.d,a.tx=s*n.a+o*n.c+n.tx,a.ty=s*n.b+o*n.d+n.ty):(t=this.scaleX,r=this.scaleY,s=this.x-this.pivotX*t,o=this.y-this.pivotY*r,a.a=t*n.a,a.b=t*n.b,a.c=r*n.c,a.d=r*n.d,a.tx=s*n.a+o*n.c+n.tx,a.ty=s*n.b+o*n.d+n.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},y.prototype.upAnimation=function(t){this.Animator.update(t)},y.prototype.getGlobalPos=function(){return{x:this.worldTransform.tx,y:this.worldTransform.ty}},y.prototype.on=function(t,e){this.event.on(t,e)},y.prototype.off=function(t,e){this.event.off(t,e)},y.prototype.once=function(t,e){this.event.once(t,cb)},y.prototype.getBounds=function(){for(var t=[],e=this.bounds.length>>1,i=0;i<e;i++){var r=this.worldTransform.apply({x:this.bounds[2*i],y:this.bounds[2*i+1]});t[2*i]=r.x,t[2*i+1]=r.y}return t},y.prototype.setBounds=function(t,e){},y.prototype.ContainsPoint=function(t,e,i){for(var r,s=t.length>>1,o=t[2*s-3]-i,n=t[2*s-2]-e,a=t[2*s-1]-i,h=0;h<s;h++)r=n,o=a,n=t[2*h]-e,a=t[2*h+1]-i,o!=a&&(lup=a>o);var c=0;for(h=0;h<s;h++)if(r=n,o=a,n=t[2*h]-e,a=t[2*h+1]-i,!(o<0&&a<0||o>0&&a>0||r<0&&n<0)){if(o==a&&Math.min(r,n)<=0)return!0;if(o!=a){var p=r+(n-r)*-o/(a-o);if(0===p)return!0;p>0&&c++,0===o&&lup&&a>o&&c--,0===o&&!lup&&a<o&&c--,lup=a>o}}return 1==(1&c)},S.Container=m,m.prototype=Object.create(S.DisplayObject.prototype),m.prototype.constructor=S.Container,m.prototype.addChilds=function(t){if(void 0===t)return t;var e=arguments.length;if(e>1){for(var i=0;i<e;i++)this.addChilds(arguments[i]);return arguments[e-1]}return t.parent&&t.parent.removeChilds(t),t.parent=this,this.cds.push(t),t},m.prototype.removeChilds=function(){var t=arguments.length;if(t>1)for(var e=0;e<t;e++)this.removeChilds(arguments[e]);else if(1===t)for(var i=0;i<this.cds.length;i++)this.cds[i]===arguments[0]&&(this.cds.splice(i,1),this.cds[i].parent=null,i--)},m.prototype.updateTransform=function(t){this._ready&&(t=this.timeScale*t,!this.paused&&this.upAnimation(t),this.updateMe(),this.cds.length>0&&this.updateChilds(t))},m.prototype.updateChilds=function(t){for(var e=0,i=this.cds.length;e<i;e++){var r=this.cds[e];r.updateTransform(t)}},m.prototype.render=function(t){this.renderMe(t),this.cds.length>0&&this.renderChilds(t)},m.prototype.renderMe=function(){return!0},m.prototype.renderChilds=function(t){for(var e=0,i=this.cds.length;e<i;e++){var r=this.cds[e];r.isVisible()&&r._ready&&r.render(t)}},m.prototype.noticeEvent=function(t){for(var e=this.cds.length-1;e>=0;){var i=this.cds[e];if(i.visible&&(i.noticeEvent(t),t.target))break;e--}this.upEvent(t)},m.prototype.upEvent=function(t){if(this._ready&&(t.target||!this.passEvent&&this.hitTest(t))&&(!t.cancleBubble||t.target===this)){if(!(this.event.listeners[t.type]&&this.event.listeners[t.type].length>0))return;this.event.emit(t)}},m.prototype.hitTest=function(t){if("touchmove"===t.type||"touchend"===t.type||"mousemove"===t.type||"mouseup"===t.type){var e=this.event.touchstarted;return e&&(t.target=this),"touchend"!==t.type&&"mouseup"!==t.type||(this.event.touchstarted=!1),e}return!!this.hitTestMe(t)&&(t.target=this,"touchstart"!==t.type&&"mousedown"!==t.type||(this.event.touchstarted=!0),!0)},m.prototype.hitTestMe=function(t){return this.ContainsPoint(this.getBound(),t.global.x,t.global.y)},m.prototype.pause=function(){this.paused=!0},m.prototype.start=function(){this.paused=!1},m.prototype.cancle=function(){this.Animator.animates.length=0},S.Sprite=g,g.prototype=Object.create(S.Container.prototype),g.prototype.constructor=S.Sprite,Object.defineProperties(g.prototype,{texture:{get:function(){return this._texture},set:function(t){if(this._texture!==t&&(this._texture=t,this.cachedTint=16777215,t))if(t.baseTexture.hasLoaded)this.upTexture(),this._ready=!0;else{var e=this;t.on("loaded",function(){e.upTexture(),e._ready=!0})}}},aColor:{get:function(){return this.tint===this.cachedTint&&this.cachedAlpha===this.alpha&&this.colors?this.colors:(this.cachedTint=this.tint,this.cachedAlpha=this.alpha,this.colors=new Float32Array(S.UTILS.hex2rgb(this.tint).concat([this.alpha])),this.colors)}}}),g.prototype.upTexture=function(){this.width=this.texture.width,this.height=this.texture.height,this.regX=this.width>>1,this.regY=this.height>>1,this.vertices=new Float32Array([-this.regX,this.regY,this.width-this.regX,this.regY,this.width-this.regX,this.regY-this.height,-this.regX,this.regY-this.height]),this.setBounds(null,!0)},g.prototype.setBounds=function(t,e){var i=this.bounds.length;i>4&&e||(t=t||this.vertices,this.bounds=t)},g.prototype.renderMe=function(t){if(this._ready){t.blendModeManager.setBlendMode(this.blendMode),t.shaderManager.setShader(this.shaderType);var e=t.shaderManager.currentShader;e.uniforms.projectionMatrix.value=this.worldTransform.toArray(!0),e.uniforms.projectionVector.value=t.projection,e.uniforms.uSampler.value=this.texture,e.syncUniforms();var i=t.gl;this.dynamicBuffer||this.initBuffers(i,e),this.uploadDynamic(i),this.bindBuffers(i,e),i.drawElements(i.TRIANGLES,this.indices.length,i.UNSIGNED_SHORT,0)}},g.prototype.initBuffers=function(t,e){var i,r,s=0;this.dynamicStride=0;for(i in e.attributes)r=e.attributes[i],r.offset=s,s+=r.size,this.dynamicStride+=r.size;this.dynamicData=new Float32Array(4*this.dynamicStride),this.dynamicBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.dynamicBuffer),t.bufferData(t.ARRAY_BUFFER,this.dynamicData,t.DYNAMIC_DRAW),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},g.prototype.bindBuffers=function(t,e){var i,r;t.bindBuffer(t.ARRAY_BUFFER,this.dynamicBuffer);for(i in e.attributes)r=e.attributes[i],t.enableVertexAttribArray(r._location),t.vertexAttribPointer(r._location,r.size,t.FLOAT,!1,4*this.dynamicStride,4*r.offset);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},g.prototype.uploadDynamic=function(t){var e=this.texture._uvs.get();if(!this.update){for(var i=0;i<4;i++)this.dynamicData[i*this.dynamicStride]=this.vertices[2*i],this.dynamicData[i*this.dynamicStride+1]=this.vertices[2*i+1],this.dynamicData[i*this.dynamicStride+2]=e[2*i],this.dynamicData[i*this.dynamicStride+3]=e[2*i+1],this.dynamicData[i*this.dynamicStride+4]=this.aColor[0],this.dynamicData[i*this.dynamicStride+5]=this.aColor[1],this.dynamicData[i*this.dynamicStride+6]=this.aColor[2],this.dynamicData[i*this.dynamicStride+7]=this.aColor[3];
this.update=!0}t.bindBuffer(t.ARRAY_BUFFER,this.dynamicBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.dynamicData)},g.prototype.getBounds=function(){},g.prototype.containsPoint=function(t){return!0},S.ParticleContainer=v,v.prototype=Object.create(S.Container.prototype),v.prototype.constructor=S.ParticleContainer,v.prototype.setProperties=function(t){t&&(this._properties[0]="scale"in t?!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="alpha"in t?!!t.alpha:this._properties[4])},v.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},v.prototype.render=function(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(renderer.setObjectRenderer(renderer.plugins.particle),renderer.plugins.particle.render(this))},S.Renderer=T,T.prototype.constructor=S.Renderer,T.prototype._createContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");t.renderer=this},T.prototype._initContext=function(){var t=this.gl;t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.event.emit({type:"context"},t),this.resize(this.width,this.height)},T.prototype.render=function(t){(this.pt<=0||Date.now()-this.pt>200)&&(this.pt=Date.now());var e=Date.now()-this.pt;if(this.pt+=e,this.event.emit({type:"prerender"}),!this.gl.isContextLost()){this.renderSession.projection=this.projection;var i=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(this.timeScale*e),t.parent=i;var r=this.gl;this.autoClear&&(this.transparent?r.clearColor(0,0,0,0):r.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),r.clear(r.COLOR_BUFFER_BIT)),this.renderDisplayObject(t),this.event.emit({type:"postrender"})}},T.prototype.renderDisplayObject=function(t){t.render(this.renderSession)},T.prototype.handleContextLost=function(t){t.preventDefault()},T.prototype.handleContextRestored=function(){this._initContext()},T.prototype._mapGlModes=function(){var t=this.gl;this.blendModes||(this.blendModes={},this.blendModes[S.CONST.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[S.CONST.BLEND_MODES.ADD]=[t.ONE,t.DST_ALPHA],this.blendModes[S.CONST.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],this.blendModes[S.CONST.BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR]),this.drawModes||(this.drawModes={},this.drawModes[S.CONST.DRAW_MODES.POINTS]=t.POINTS,this.drawModes[S.CONST.DRAW_MODES.LINES]=t.LINES,this.drawModes[S.CONST.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,this.drawModes[S.CONST.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,this.drawModes[S.CONST.DRAW_MODES.TRIANGLES]=t.TRIANGLES,this.drawModes[S.CONST.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,this.drawModes[S.CONST.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN)},Object.defineProperties(T.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=S.UTILS.hex2string(t),S.UTILS.hex2rgb(t,this._backgroundColorRgb)}}}),T.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.projection=new Float32Array([this.width>>1,this.height>>1]),this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},S.ShaderManager=x,x.prototype.constructor=S.ShaderManager,x.prototype.init=function(){var t=this.renderer.gl;this.maxAttibs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.shaderPool={particle:new A(t),sprite:new E(t),graphics:new w(t)}},x.prototype.setShader=function(t){return this.shaderType!==t&&(this.currentShader=this.shaderPool[t],this.renderer.gl.useProgram(this.currentShader.program),this.shaderType=t,!0)},S.BlendModeManager=_,_.prototype.constructor=S.BlendModeManager,_.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=this.renderer.blendModes[this.currentBlendMode];return this.renderer.gl.blendFunc(e[0],e[1]),!0},b.prototype.constructor=b,b.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},b.prototype.cacheUniformLocations=function(t){for(var e=0;e<t.length;++e)this.uniforms[t[e]]._location=this.gl.getUniformLocation(this.program,t[e])},b.prototype.cacheAttributeLocations=function(t){for(var e=0;e<t.length;++e)this.attributes[t[e]]._location=this.gl.getAttribLocation(this.program,t[e])},b.prototype.compile=function(){var t=this.gl,e=this._glCompile(t.VERTEX_SHADER,this.vertexSrc),i=this._glCompile(t.FRAGMENT_SHADER,this.fragmentSrc),r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||(console.error("jcw2d.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(r,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(r)&&console.warn("jcw2d.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(r)),t.deleteProgram(r),r=null),t.deleteShader(e),t.deleteShader(i),this.program=r},b.prototype.syncUniform=function(t){var e,i,r=t._location,s=t.value,o=this.gl;switch(t.type){case"b":case"bool":case"boolean":o.uniform1i(r,s?1:0);break;case"i":case"1i":o.uniform1i(r,s);break;case"f":case"1f":o.uniform1f(r,s);break;case"2f":o.uniform2f(r,s[0],s[1]);break;case"3f":o.uniform3f(r,s[0],s[1],s[2]);break;case"4f":o.uniform4f(r,s[0],s[1],s[2],s[3]);break;case"v2":o.uniform2f(r,s.x,s.y);break;case"v3":o.uniform3f(r,s.x,s.y,s.z);break;case"v4":o.uniform4f(r,s.x,s.y,s.z,s.w);break;case"1iv":o.uniform1iv(r,s);break;case"2iv":o.uniform2iv(r,s);break;case"3iv":o.uniform3iv(r,s);break;case"4iv":o.uniform4iv(r,s);break;case"1fv":o.uniform1fv(r,s);break;case"2fv":o.uniform2fv(r,s);break;case"3fv":o.uniform3fv(r,s);break;case"4fv":o.uniform4fv(r,s);break;case"m2":case"mat2":case"Matrix2fv":o.uniformMatrix2fv(r,t.transpose||!1,s);break;case"m3":case"mat3":case"Matrix3fv":o.uniformMatrix3fv(r,t.transpose||!1,s);break;case"m4":case"mat4":case"Matrix4fv":o.uniformMatrix4fv(r,t.transpose||!1,s);break;case"c":"number"==typeof s&&(s=utils.hex2rgb(s)),o.uniform3f(r,s[0],s[1],s[2]);break;case"iv1":o.uniform1iv(r,s);break;case"iv":o.uniform3iv(r,s);break;case"fv1":o.uniform1fv(r,s);break;case"fv":o.uniform3fv(r,s);break;case"v2v":for(t._array||(t._array=new Float32Array(2*s.length)),e=0,i=s.length;e<i;++e)t._array[2*e]=s[e].x,t._array[2*e+1]=s[e].y;o.uniform2fv(r,t._array);break;case"v3v":for(t._array||(t._array=new Float32Array(3*s.length)),e=0,i=s.length;e<i;++e)t._array[3*e]=s[e].x,t._array[3*e+1]=s[e].y,t._array[3*e+2]=s[e].z;o.uniform3fv(r,t._array);break;case"v4v":for(t._array||(t._array=new Float32Array(4*s.length)),e=0,i=s.length;e<i;++e)t._array[4*e]=s[e].x,t._array[4*e+1]=s[e].y,t._array[4*e+2]=s[e].z,t._array[4*e+3]=s[e].w;o.uniform4fv(r,t._array);break;case"t":case"sampler2D":if(!t.value||!t.value.baseTexture.hasLoaded)break;o.activeTexture(o["TEXTURE"+this.textureCount]);var n=t.value.baseTexture.texture;n||(this.initSampler2D(t),n=t.value.baseTexture.texture),o.bindTexture(o.TEXTURE_2D,n),o.uniform1i(t._location,this.textureCount),this.textureCount++;break;default:console.warn("jcw2d.js Shader Warning: Unknown uniform type: "+t.type)}},b.prototype.syncUniforms=function(){this.textureCount=1;for(var t in this.uniforms)this.syncUniform(this.uniforms[t])},b.prototype.initSampler2D=function(t){var e=(this.gl,t.value.baseTexture);e.hasLoaded&&this.updateTexture(e)},b.prototype.updateTexture=function(t){if(t=t.baseTexture||t,t.hasLoaded){var e=this.gl;return t.texture||(t.texture=e.createTexture(),t.on("update",this.updateTexture,this)),e.bindTexture(e.TEXTURE_2D,t.texture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===S.CONST.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&t.isPowerOfTwo?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===S.CONST.SCALE_MODES.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===S.CONST.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),t.isPowerOfTwo?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t.texture}},b.prototype._glCompile=function(t,e){var i=this.gl.createShader(t);return this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(console.log(this.gl.getShaderInfoLog(i)),null)},E.prototype=Object.create(b.prototype),E.prototype.constructor=E,A.prototype=Object.create(b.prototype),A.prototype.constructor=A,w.prototype=Object.create(b.prototype),w.prototype.constructor=w,S});
//# sourceMappingURL=../maps/jcw2d.js.map
