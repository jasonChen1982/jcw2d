!function(){function t(){}function e(){this.MST=0,this.MAT=300,this.fx="easeBoth",this.complete=t,this.moving=!1,this.infinity=!1,this.alternate=!1,this.repeats=0}window.JC=window.JC||{},function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),r=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+r)},r);return t=i+r,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.RAF=window.requestAnimFrame=window.requestAnimationFrame}(),JC.TWEEN={easeBoth:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},extend:function(t){if(t)for(var e in t)"extend"!==e&&t[e]&&(this[e]=t[e])}},JC.Math={clamp:function(t,e,i){return t<e?e:t>i?i:t},randIn:function(t,e){return t+Math.random()*(e-t)}},JC.Texture=function(t,e){this.id=t,this.img=e,this.width=e.width,this.height=e.height,this.isPowerOfTwo=JC.isPowerOfTwo(this.width,this.height)},JC.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},JC.TextureCache={},JC.ImageLoader=function(t,e){this.receiveNum=0,this.failNum=0,this.requestNum=0,this.crossorigin=e,this.sources=t||{},this.imgs={},this.loading()},JC.ImageLoader.prototype.constructor=JC.ImageLoader,JC.ImageLoader.prototype.loading=function(){function t(t,i){i.onload=function(){e.receiveNum++,JC.TextureCache[t]=new JC.Texture(t,i),e.receiveNum+e.failNum>=e.requestNum&&(e.onLoaded(),e.failNum>0&&e.onFailed())},i.onerror=function(){e.failNum++}}var e=this;for(var i in this.sources)this.imgs[i]=new Image,t(i,this.imgs[i]),this.crossorigin&&(this.imgs[i].crossOrigin=""),this.imgs[i].src=this.sources[i],this.requestNum++},JC.ImageLoader.prototype.getTexture=function(t){return JC.TextureCache[t]},JC.ImageLoader.prototype.onLoaded=function(){},JC.ImageLoader.prototype.onFailed=function(){},JC.VERSION="v0.0.3",JC.blendModes={NORMAL:0,ALPHA:1,ADD:2,MULTIPLY:3,SCREEN:4},JC.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},"undefined"!=typeof Float32Array?(JC.Float32Array=Float32Array,JC.Uint16Array=Uint16Array,JC.Uint32Array=Uint32Array,JC.ArrayBuffer=ArrayBuffer):(JC.Float32Array=Array,JC.Uint16Array=Array,JC.Uint32Array=Array,JC.ArrayBuffer=Array,console.log("%c not type array ","color: #fff;background: #f00;")),JC.PI_2=2*Math.PI,JC.RTD=180/Math.PI,JC.DTR=Math.PI/180,JC.dontSpeek=!1,JC.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},JC.sayHello=function(t){if(!JC.dontSpeek){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["%c  %c jcw2d.js "+JC.VERSION+"  %c  %c  http://www.jason82.com/ %c  ","background: #80a89e","color: #f98165; background: #cad9d5;","background: #80a89e","background: #cad9d5","background: #80a89e"];console.log.apply(console,e)}else console.log(" jcw2d.js "+JC.VERSION+"  http://www.jason82.com/  ");JC.dontSpeek=!0}},JC.Point=function(t,e){this.x=t||0,this.y=e||0},JC.Point.prototype.clone=function(){return new JC.Point(this.x,this.y)},JC.Point.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)},JC.Point.prototype.constructor=JC.Point,JC.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},JC.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},JC.Matrix.prototype.toArray=function(t){this.array||(this.array=new JC.Float32Array(9));var e=this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},JC.Matrix.prototype.apply=function(t,e){return e=e||new JC.Point,e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},JC.Matrix.prototype.applyInverse=function(t,e){e=e||new JC.Point;var i=1/(this.a*this.d+this.c*-this.b);return e.x=this.d*i*t.x+-this.c*i*t.y+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*t.y+-this.b*i*t.x+(-this.ty*this.a+this.tx*this.b)*i,e},JC.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},JC.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},JC.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,n=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this},JC.Matrix.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,s=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},JC.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},JC.identityMatrix=new JC.Matrix,e.prototype.moveTween=function(t){this.MST=Date.now(),this.MATR=t.attr||this.MATR,this.MAT=t.time||this.MAT,this.fx=t.fx||this.fx,this.complete=t.complete||this.complete,this.infinity=t.infinity||this.infinity,this.alternate=t.alternate||this.alternate,this.repeats=t.repeats||this.repeats,this.moving=!0,this.MATRC={};for(var e in this.MATR)this.MATRC[e]=this[e]},e.prototype.manager=function(){if(this.moving){var e=Date.now();e<this.MST+this.MAT?this.nextPose():(this.setVal(this.MATR),this.repeats>0||this.infinity?(this.repeats>0&&--this.repeats,this.alternate?this.moveTween({attr:this.MATRC}):(this.setVal(this.MATRC),this.moveTween({attr:this.MATR}))):(this.moving=!1,this.complete(),e>this.MST&&(this.complete=t)))}},e.prototype.nextPose=function(){var t=Date.now()-this.MST;for(var e in this.MATR)this[e]=JC.TWEEN[this.fx](t,this.MATRC[e],this.MATR[e]-this.MATRC[e],this.MAT)},JC.DisplayObject=function(){e.call(this),this.visible=!0,this.worldAlpha=1,this.alpha=1,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.rotation=0,this.rotationCache=0,this._sr=0,this._cr=1,this.x=0,this.y=0,this.pivotX=0,this.pivotY=0,this._mask=null,this.parent=null,this.worldTransform=new JC.Matrix,this.renderable=!1,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},JC.DisplayObject.prototype=Object.create(e.prototype),JC.DisplayObject.prototype.constructor=JC.DisplayObject,Object.defineProperty(JC.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(JC.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),JC.DisplayObject.prototype.setVal=function(t){if(void 0!==t)for(var e in t)void 0!==this[e]&&(this[e]=t[e])},JC.DisplayObject.prototype.upDate=function(t){t.texturesManager.setTexture(this.texture),t.shaderManager.setShader(this.shaderType),t.blendModeManager.setBlendMode(this.blendMode),this.dirty&&this.createBuffer(t.gl),this.syncAttribute(t),this.syncUniforms(t)},JC.DisplayObject.prototype.updateTransform=function(){var t,e,i,r,s,n,o=this.parent.worldTransform,a=this.worldTransform;this.rotation%JC.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scaleX,e=this._sr*this.scaleX,i=-this._sr*this.scaleY,r=this._cr*this.scaleY,s=this.x,n=this.y,(this.pivotX||this.pivotY)&&(s-=this.pivotX*t+this.pivotY*i,n-=this.pivotX*e+this.pivotY*r),a.a=t*o.a+e*o.c,a.b=t*o.b+e*o.d,a.c=i*o.a+r*o.c,a.d=i*o.b+r*o.d,a.tx=s*o.a+n*o.c+o.tx,a.ty=s*o.b+n*o.d+o.ty):(t=this.scaleX,r=this.scaleY,s=this.x-this.pivotX*t,n=this.y-this.pivotY*r,a.a=t*o.a,a.b=t*o.b,a.c=r*o.c,a.d=r*o.d,a.tx=s*o.a+n*o.c+o.tx,a.ty=s*o.b+n*o.d+o.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this.manager()},JC.DisplayObject.prototype.displayObjectUpdateTransform=JC.DisplayObject.prototype.updateTransform,JC.DisplayObject.prototype.render=function(t){t=t},JC.DisplayObjectContainer=function(){JC.DisplayObject.call(this),this.children=[]},JC.DisplayObjectContainer.prototype=Object.create(JC.DisplayObject.prototype),JC.DisplayObjectContainer.prototype.constructor=JC.DisplayObjectContainer,JC.DisplayObjectContainer.prototype.addChilds=function(){var t=arguments.length;if(t>0){for(var e=0;e<t;e++)this.addChildAt(arguments[e],this.children.length);return arguments[t-1]}},JC.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},JC.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[r]=t}},JC.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e},JC.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},JC.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},JC.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(e!==-1)return this.removeChildAt(e)},JC.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},JC.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,r="number"==typeof e?e:this.children.length,s=r-i;if(s>0&&s<=r){for(var n=this.children.splice(i,s),o=0;o<n.length;o++){var a=n[o];this.stage&&a.removeStageReference(),a.parent=void 0}return n}if(0===s&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},JC.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()}},JC.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=JC.DisplayObjectContainer.prototype.updateTransform,JC.DisplayObjectContainer.prototype.render=function(t){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);var e,i;if(this._mask){for(this._mask&&t.maskManager.pushMask(this.mask,t),e=0,i=this.children.length;e<i;e++)this.children[e].render(t);this._mask&&t.maskManager.popMask(this._mask,t)}else for(e=0,i=this.children.length;e<i;e++)this.children[e].render(t)}},JC.Sprite=function(t){JC.DisplayObjectContainer.call(this),this.texture=t.texture,this.width=t.width||this.texture.width,this.height=t.height||this.texture.height,this.sH=t.sH||0,this.sW=t.sW||0,this.tint=t.tint||16777215,this.blendMode=t.blendModes||JC.blendModes.ALPHA,this.shader=null,this.shaderType="sprite",this.repeatX=t.repeatX||!1,this.repeatY=t.repeatY||!1,this.renderable=!0,this.buildMesh()},JC.Sprite.prototype=Object.create(JC.DisplayObjectContainer.prototype),JC.Sprite.prototype.constructor=JC.Sprite,JC.Sprite.prototype.buildMesh=function(){var t=this.texture.width,e=this.texture.height;if(this.vertices=new JC.Float32Array([-this.width/2,this.height/2,-this.width/2,-this.height/2,this.width/2,-this.height/2,this.width/2,this.height/2]),this.indices=new JC.Uint16Array([0,1,2,0,2,3]),this.repeatX||this.repeatY){var i=this.repeatX?2:1,r=this.repeatY?2:1;this.uvs=new JC.Float32Array([0*i,0*r,0*i,1*r,1*i,1*r,1*i,0*r])}else this.uvs=new JC.Float32Array([this.sW/t,this.sH/e,this.sW/t,(this.sH+this.height)/e,(this.sW+this.width)/t,(this.sH+this.height)/e,(this.sW+this.width)/t,this.sH/e]);this.cachedTint=JC.hex2rgb(this.tint),this.dirty=!0},JC.Sprite.prototype.createBuffer=function(t){this.vertexBuffer=t.createBuffer(),this.uvsBuffer=t.createBuffer(),this.indicesBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,this.uvsBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.dirty=!1},JC.Sprite.prototype.syncUniforms=function(t){var e=t.gl,i=t.shaderManager.shader,r=t.projection;e.uniform1i(i.uSampler,0),e.uniform1f(i.uAlpha,this.worldAlpha),e.uniform2f(i.projectionVector,r.x,r.y),e.uniformMatrix3fv(i.uMatrix,!1,this.worldTransform.toArray(!0)),e.uniform3fv(i.uTint,this.cachedTint)},JC.Sprite.prototype.syncAttribute=function(t){var e=t.gl,i=t.shaderManager.shader;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(i.aVertexPosition),e.vertexAttribPointer(i.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.uvsBuffer),e.enableVertexAttribArray(i.aTextureCoord),e.vertexAttribPointer(i.aTextureCoord,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)},JC.Sprite.prototype.render=function(t){if(this.visible&&!(this.alpha<=0)){this.upDate(t);var e,i,r=t.gl;if(this._mask){for(this._mask&&t.maskManager.pushMask(this.mask,t),r.drawElements(r.TRIANGLES,this.indices.length,r.UNSIGNED_SHORT,0),e=0,i=this.children.length;e<i;e++)this.children[e].render(t);this._mask&&t.maskManager.popMask(this._mask,t)}else for(r.drawElements(r.TRIANGLES,this.indices.length,r.UNSIGNED_SHORT,0),e=0,i=this.children.length;e<i;e++)this.children[e].render(t)}},JC.Sprite.fromFrame=function(t){var e=JC.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new JC.Sprite(e)},JC.Sprite.fromImage=function(t,e,i){var r=JC.Texture.fromImage(t,e,i);return new JC.Sprite(r)},JC.Stage=function(t){JC.DisplayObjectContainer.call(this),this.worldTransform=new JC.Matrix,this.stage=this,this.setBackgroundColor(t)},JC.Stage.prototype=Object.create(JC.DisplayObjectContainer.prototype),JC.Stage.prototype.constructor=JC.Stage,JC.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},JC.Stage.prototype.setBackgroundColor=function(t){"number"!=typeof t&&(this.backgroundColor=JC.hex2rgb(t))},JC.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},JC.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(t){function e(){for(var r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return n=s.concat(n),i.apply(this instanceof e?this:t,n)}var i=this,r=arguments.length-1,s=[];if(r>0)for(s.length=r;r--;)s[r]=arguments[r+1];if("function"!=typeof i)throw new TypeError;return e.prototype=function n(t){if(t&&(n.prototype=t),!(this instanceof n))return new n}(i.prototype),e}}()),JC.getNextPowerOfTwo=function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},JC.isPowerOfTwo=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},JC.CompileVertexShader=function(t,e){return JC._CompileShader(t,e,t.VERTEX_SHADER)},JC.CompileFragmentShader=function(t,e){return JC._CompileShader(t,e,t.FRAGMENT_SHADER)},JC._CompileShader=function(t,e,i){var r=e.join("\n"),s=t.createShader(i);return t.shaderSource(s,r),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(window.console.log(t.getShaderInfoLog(s)),null)},JC.compileProgram=function(t,e,i){var r=JC.CompileFragmentShader(t,i),s=JC.CompileVertexShader(t,e),n=t.createProgram();return t.attachShader(n,s),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),n},JC.SpriteShader=function(t){this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform vec3 uTint;","uniform float uAlpha;","void main(void) {","   vec4 smpColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor = vec4(uTint,uAlpha) * smpColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform vec2 projectionVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","void main(void) {","   vec2 v = ( uMatrix * vec3(aVertexPosition , 1.0) ).xy ;","   gl_Position = vec4( v / projectionVector , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.textureCount=0,this.init()},JC.SpriteShader.prototype.constructor=JC.SpriteShader,JC.SpriteShader.prototype.init=function(){var t=this.gl,e=JC.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.uMatrix=t.getUniformLocation(e,"uMatrix"),this.uTint=t.getUniformLocation(e,"uTint"),this.uAlpha=t.getUniformLocation(e,"uAlpha"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.program=e},JC.SpriteShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null},JC.PointShader=function(t){this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform vec3 uTint;","uniform float uAlpha;","varying vec4 vPointColor;","void main(void) {","   vec4 smpColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor = vec4(uTint,uAlpha) * smpColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aPointColor;","uniform vec2 projectionVector;","uniform mat3 uMatrix;","varying vec4 vPointColor;","void main(void) {","   vec2 v = ( uMatrix * vec3(aVertexPosition , 1.0) ).xy ;","   gl_Position = vec4( v / projectionVector , 0.0, 1.0);","   vPointColor = aPointColor;","}"],this.textureCount=0,this.init()},JC.PointShader.prototype.constructor=JC.PointShader,JC.PointShader.prototype.init=function(){var t=this.gl,e=JC.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.uMatrix=t.getUniformLocation(e,"uMatrix"),this.uTint=t.getUniformLocation(e,"uTint"),this.uAlpha=t.getUniformLocation(e,"uAlpha"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.program=e},JC.PointShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null},JC.Renderer=function(t,e,i){if(i)for(var r in JC.defaultRenderOptions)"undefined"==typeof i[r]&&(i[r]=JC.defaultRenderOptions[r]);else i=JC.defaultRenderOptions;JC.sayHello(),this.resolution=i.resolution||window.devicePixelRatio,this.transparent=i.transparent,this.autoResize=i.autoResize||!1,this.clearBeforeRender=i.clearBeforeRender||!0,this.width=t||800,this.height=e||600,this.view=i.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.projection=new JC.Point,this.offset=new JC.Point(0,0),this.shaderManager=new JC.ShaderManager,this.texturesManager=new JC.TexturesManager,this.maskManager=new JC.WebGLMaskManager,this.blendModeManager=new JC.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.shaderManager=this.shaderManager,this.renderSession.texturesManager=this.texturesManager,this.renderSession.maskManager=this.maskManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},JC.Renderer.prototype.constructor=JC.Renderer,JC.Renderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.texturesManager.setContext(t),this.maskManager.setContext(t),this.blendModeManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},JC.Renderer.prototype.render=function(t){if(!this.contextLost){t.updateTransform();var e=this.gl;this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColor[0],t.backgroundColor[1],t.backgroundColor[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},JC.Renderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.blendModeManager.setBlendMode(JC.blendModes.ALPHA),this.renderSession.projection=e,this.renderSession.offset=this.offset,t.render(this.renderSession)},JC.Renderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=this.height/2/this.resolution},JC.Renderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},JC.Renderer.prototype.handleContextRestored=function(){this.initContext(),this.contextLost=!1},JC.Renderer.prototype.mapBlendModes=function(){var t=this.gl;JC.blendModesWebGL||(JC.blendModesWebGL=[],JC.blendModesWebGL[JC.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],JC.blendModesWebGL[JC.blendModes.ALPHA]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA],JC.blendModesWebGL[JC.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],JC.blendModesWebGL[JC.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],JC.blendModesWebGL[JC.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE])},JC.TexturesManager=function(){this.textures={}},JC.TexturesManager.prototype.constructor=JC.TexturesManager,JC.TexturesManager.prototype.setContext=function(t){this.gl=t},JC.TexturesManager.prototype.setTexture=function(t){var e=this.gl;return this.currentId!==t.id&&(void 0===this.textures[t.id]&&this.setPara(t),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.textures[t.id].texture),this.currentId=t.id,!0)},JC.TexturesManager.prototype.setPara=function(t){var e=this.gl;t.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.img),t.isPowerOfTwo&&e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),this.textures[t.id]=t,e.bindTexture(e.TEXTURE_2D,null)},JC.TexturesManager.prototype.destroy=function(){this.gl=null},JC.WebGLBlendModeManager=function(){this.currentBlendMode=99999},JC.WebGLBlendModeManager.prototype.constructor=JC.WebGLBlendModeManager,JC.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},JC.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=JC.blendModesWebGL[this.currentBlendMode];return this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(e[0],e[1]),!0},JC.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},JC.ShaderManager=function(){this.shaders={}},JC.ShaderManager.prototype.constructor=JC.ShaderManager,JC.ShaderManager.prototype.setContext=function(t){this.gl=t,this.shaders.sprite=new JC.SpriteShader(t),this.shaders.particle=new JC.PointShader(t),this.setShader("sprite")},JC.ShaderManager.prototype.setShader=function(t){return this._curShaderType!==t&&(this._curShaderType=t,this.shader=this.shaders[t],this.gl.useProgram(this.shader.program),!0)},JC.ShaderManager.prototype.destroy=function(){this.gl=null},JC.WebGLMaskManager=function(){},JC.WebGLMaskManager.prototype.constructor=JC.WebGLMaskManager,JC.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},JC.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;i.enable(i.STENCIL_TEST),i.depthMask(!1),i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,1,-1),i.stencilOp(i.KEEP,i.REPLACE,i.REPLACE),i.depthMask(!0),i.colorMask(!0,!0,!0,!0),i.stencilFunc(i.EQUAL,1,-1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)},JC.WebGLMaskManager.prototype.popMask=function(){var t=this.gl;t.disable(t.STENCIL_TEST)},JC.WebGLMaskManager.prototype.destroy=function(){this.gl=null},"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?exports=module.exports=JC:exports=JC:"undefined"!=typeof define&&define.amd?define(JC):window.JC=JC}();
//# sourceMappingURL=../maps/jcw2d.js.map
