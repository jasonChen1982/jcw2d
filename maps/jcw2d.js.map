{"version":3,"sources":["RAF.js","jcw2d.js","texture.js","tween.js"],"names":["lastTime","vendors","x","length","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","RAF","requestAnimFrame","noop","Animate","this","MST","MAT","fx","complete","moving","infinity","alternate","repeats","root","JC","VERSION","blendModes","NORMAL","ALPHA","ADD","MULTIPLY","SCREEN","scaleModes","DEFAULT","LINEAR","NEAREST","Float32Array","Uint16Array","Uint32Array","ArrayBuffer","Array","console","log","PI_2","PI","RTD","DTR","dontSpeek","defaultRenderOptions","view","transparent","antialias","preserveDrawingBuffer","resolution","clearBeforeRender","autoResize","sayHello","type","navigator","userAgent","toLowerCase","indexOf","args","apply","Point","y","prototype","clone","set","constructor","Matrix","a","b","c","d","tx","ty","fromArray","array","toArray","transpose","pos","newPos","applyInverse","translate","scale","rotate","angle","cos","sin","a1","c1","tx1","append","matrix","b1","d1","identity","identityMatrix","moveTween","opts","now","MATR","attr","time","MATRC","i","manager","nextPose","setVal","TWEEN","DisplayObject","call","visible","worldAlpha","alpha","scaleX","scaleY","skewX","skewY","rotation","rotationCache","_sr","_cr","pivotX","pivotY","_mask","parent","worldTransform","renderable","_cacheAsBitmap","_cacheIsDirty","Object","create","defineProperty","get","value","isMask","_generateCachedSprite","_destroyCachedSprite","vals","undefined","key","updateTransform","pt","wt","displayObjectUpdateTransform","render","renderSession","DisplayObjectContainer","children","addChilds","l","arguments","addChildAt","child","index","removeChild","splice","Error","swapChildren","child2","index1","getChildIndex","index2","setChildIndex","currentIndex","getChildAt","removeChildAt","stage","removeStageReference","removeChildren","beginIndex","endIndex","begin","end","range","removed","j","displayObjectContainerUpdateTransform","_renderCachedSprite","maskManager","pushMask","mask","popMask","Sprite","texture","width","height","sH","sW","tint","blendMode","shader","repeatX","repeatY","buildMesh","w","h","vertices","indices","rX","rY","uvs","cachedTint","hex2rgb","dirty","createBuffer","gl","vertexBuffer","uvsBuffer","indicesBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","syncUniforms","shaderManager","projection","uniform1i","uSampler","uniform1f","uAlpha","uniform2f","projectionVector","uniformMatrix3fv","uMatrix","uniform3fv","uTint","syncAttribute","enableVertexAttribArray","aVertexPosition","vertexAttribPointer","FLOAT","aTextureCoord","upDate","texturesManager","setTexture","blendModeManager","setBlendMode","drawElements","TRIANGLES","UNSIGNED_SHORT","fromFrame","frameId","TextureCache","fromImage","imageId","crossorigin","scaleMode","Texture","Stage","backgroundColor","setBackgroundColor","bgc","hex","rgb2hex","rgb","Function","bind","thisArg","bound","boundArgs","concat","target","TypeError","F","proto","getNextPowerOfTwo","number","result","isPowerOfTwo","CompileVertexShader","shaderSrc","_CompileShader","VERTEX_SHADER","CompileFragmentShader","FRAGMENT_SHADER","shaderType","src","join","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","compileProgram","vertexSrc","fragmentSrc","fragmentShader","vertexShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","SpriteShader","program","textureCount","init","useProgram","getUniformLocation","getAttribLocation","destroy","deleteProgram","Renderer","options","devicePixelRatio","document","createElement","contextLostBound","handleContextLost","contextRestoredBound","handleContextRestored","addEventListener","_contextOptions","premultipliedAlpha","stencil","offset","ShaderManager","TexturesManager","WebGLMaskManager","WebGLBlendModeManager","renderer","initContext","mapBlendModes","getContext","disable","DEPTH_TEST","CULL_FACE","enable","BLEND","setContext","resize","contextLost","clearColor","clear","COLOR_BUFFER_BIT","renderDisplayObject","displayObject","buffer","style","viewport","event","preventDefault","blendModesWebGL","ONE","ONE_MINUS_SRC_ALPHA","SRC_ALPHA","DST_ALPHA","DST_COLOR","textures","currentId","setPara","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","img","generateMipmap","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","currentBlendMode","blendModeWebGL","blendEquation","FUNC_ADD","blendFunc","shaders","setShader","_curShaderType","maskData","STENCIL_TEST","depthMask","colorMask","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","EQUAL","exports","module","define","amd","TextureUvs","x0","y0","x1","y1","x2","y2","x3","y3","ImageLoader","sources","receiveNum","failNum","requestNum","imgs","loading","ears","source","onload","This","onLoaded","onFailed","onerror","Image","crossOrigin","getTexture","easeBoth","t","extend"],"mappings":"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","file":"../modules/jcw2d.js","sourcesContent":["(function() {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n            window[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n\n    if (!window.requestAnimationFrame) {\n        window.requestAnimationFrame = function(callback) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); },\n              timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n    }\n\n    if (!window.cancelAnimationFrame) {\n        window.cancelAnimationFrame = function(id) {\n            clearTimeout(id);\n        };\n    }\n\n    window.RAF = window.requestAnimFrame = window.requestAnimationFrame;\n})();","(function() {\n\n    var root = this;\n\n    var JC = JC || {};\n\n    JC.VERSION = \"v0.0.3\";\n\n    JC.blendModes = {\n        NORMAL: 0,\n        ALPHA: 1,\n        ADD: 2,\n        MULTIPLY: 3,\n        SCREEN: 4\n    };\n\n    JC.scaleModes = {\n        DEFAULT: 0,\n        LINEAR: 0,\n        NEAREST: 1\n    };\n\n    if (typeof(Float32Array) != 'undefined') {\n        JC.Float32Array = Float32Array;\n        JC.Uint16Array = Uint16Array;\n\n        JC.Uint32Array = Uint32Array;\n        JC.ArrayBuffer = ArrayBuffer;\n    } else {\n        JC.Float32Array = Array;\n        JC.Uint16Array = Array;\n\n        JC.Uint32Array = Array;\n        JC.ArrayBuffer = Array;\n        console.log('%c not type array ', 'color: #fff;background: #f00;');\n    }\n\n    JC.PI_2 = Math.PI * 2;\n\n    JC.RTD = 180 / Math.PI;\n\n    JC.DTR = Math.PI / 180;\n\n    JC.dontSpeek = false;\n\n    JC.defaultRenderOptions = {\n        view: null,\n        transparent: false,\n        antialias: false,\n        preserveDrawingBuffer: false,\n        resolution: 1,\n        clearBeforeRender: true,\n        autoResize: false\n    };\n\n    function noop(){}\n\n    JC.sayHello = function(type) {\n        if (JC.dontSpeek) return;\n\n        if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {\n            var args = [\n                '%c  %c jcw2d.js ' + JC.VERSION + '  %c ' + ' %c ' + ' http://www.jason82.com/ %c  ',\n                'background: #80a89e',\n                'color: #f98165; background: #cad9d5;',\n                'background: #80a89e',\n                'background: #cad9d5',\n                'background: #80a89e'\n            ];\n\n            console.log.apply(console, args);\n        }else{\n            console.log(' jcw2d.js ' + JC.VERSION + '  http://www.jason82.com/  ');\n        }\n\n        JC.dontSpeek = true;\n    };\n\n\n    JC.Point = function(x, y) {\n        this.x = x || 0;\n\n        this.y = y || 0;\n    };\n    JC.Point.prototype.clone = function() {\n        return new JC.Point(this.x, this.y);\n    };\n    JC.Point.prototype.set = function(x, y) {\n        this.x = x || 0;\n        this.y = y || ((y !== 0) ? this.x : 0);\n    };\n    JC.Point.prototype.constructor = JC.Point;\n\n\n    JC.Matrix = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n    };\n    JC.Matrix.prototype.fromArray = function(array) {\n        this.a = array[0];\n        this.b = array[1];\n        this.c = array[3];\n        this.d = array[4];\n        this.tx = array[2];\n        this.ty = array[5];\n    };\n    JC.Matrix.prototype.toArray = function(transpose) {\n        if (!this.array) this.array = new JC.Float32Array(9);\n        var array = this.array;\n\n        if (transpose) {\n            array[0] = this.a;\n            array[1] = this.b;\n            array[2] = 0;\n            array[3] = this.c;\n            array[4] = this.d;\n            array[5] = 0;\n            array[6] = this.tx;\n            array[7] = this.ty;\n            array[8] = 1;\n        } else {\n            array[0] = this.a;\n            array[1] = this.c;\n            array[2] = this.tx;\n            array[3] = this.b;\n            array[4] = this.d;\n            array[5] = this.ty;\n            array[6] = 0;\n            array[7] = 0;\n            array[8] = 1;\n        }\n\n        return array;\n    };\n    JC.Matrix.prototype.apply = function(pos, newPos) {\n        newPos = newPos || new JC.Point();\n\n        newPos.x = this.a * pos.x + this.c * pos.y + this.tx;\n        newPos.y = this.b * pos.x + this.d * pos.y + this.ty;\n\n        return newPos;\n    };\n    JC.Matrix.prototype.applyInverse = function(pos, newPos) {\n        newPos = newPos || new JC.Point();\n\n        var id = 1 / (this.a * this.d + this.c * -this.b);\n\n        newPos.x = this.d * id * pos.x + -this.c * id * pos.y + (this.ty * this.c - this.tx * this.d) * id;\n        newPos.y = this.a * id * pos.y + -this.b * id * pos.x + (-this.ty * this.a + this.tx * this.b) * id;\n\n        return newPos;\n    };\n    JC.Matrix.prototype.translate = function(x, y) {\n        this.tx += x;\n        this.ty += y;\n\n        return this;\n    };\n    JC.Matrix.prototype.scale = function(x, y) {\n        this.a *= x;\n        this.d *= y;\n        this.c *= x;\n        this.b *= y;\n        this.tx *= x;\n        this.ty *= y;\n\n        return this;\n    };\n    JC.Matrix.prototype.rotate = function(angle) {\n        var cos = Math.cos(angle);\n        var sin = Math.sin(angle);\n\n        var a1 = this.a;\n        var c1 = this.c;\n        var tx1 = this.tx;\n\n        this.a = a1 * cos - this.b * sin;\n        this.b = a1 * sin + this.b * cos;\n        this.c = c1 * cos - this.d * sin;\n        this.d = c1 * sin + this.d * cos;\n        this.tx = tx1 * cos - this.ty * sin;\n        this.ty = tx1 * sin + this.ty * cos;\n\n        return this;\n    };\n    JC.Matrix.prototype.append = function(matrix) {\n        var a1 = this.a;\n        var b1 = this.b;\n        var c1 = this.c;\n        var d1 = this.d;\n\n        this.a = matrix.a * a1 + matrix.b * c1;\n        this.b = matrix.a * b1 + matrix.b * d1;\n        this.c = matrix.c * a1 + matrix.d * c1;\n        this.d = matrix.c * b1 + matrix.d * d1;\n\n        this.tx = matrix.tx * a1 + matrix.ty * c1 + this.tx;\n        this.ty = matrix.tx * b1 + matrix.ty * d1 + this.ty;\n\n        return this;\n    };\n    JC.Matrix.prototype.identity = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n\n        return this;\n    };\n\n    JC.identityMatrix = new JC.Matrix();\n\n\n    function Animate(){\n        this.MST = 0;\n        this.MAT = 300;\n        this.fx = 'easeBoth';\n        this.complete = noop;\n        this.moving = false;\n        this.infinity = false;\n        this.alternate = false;\n        this.repeats = 0;\n    }\n    Animate.prototype.moveTween = function(opts){\n        this.MST = Date.now();\n        this.MATR = opts.attr||this.MATR;\n        this.MAT = opts.time||this.MAT;\n        this.fx = opts.fx||this.fx;\n        this.complete = opts.complete||this.complete;\n        this.infinity = opts.infinity||this.infinity;\n        this.alternate = opts.alternate||this.alternate;\n        this.repeats = opts.repeats||this.repeats;\n        this.moving = true;\n        this.MATRC = {};\n        for(var i in this.MATR){\n            this.MATRC[i] = this[i];\n        }\n    };\n    Animate.prototype.manager = function(){\n        if(!this.moving)return;\n        var now = Date.now();\n        if(now < this.MST+this.MAT){\n            this.nextPose();\n        }else{\n            this.setVal(this.MATR);\n            if(this.repeats>0||this.infinity){\n                this.repeats>0&&--this.repeats;\n                if(this.alternate){\n                    this.moveTween({attr: this.MATRC});\n                }else{\n                    this.setVal(this.MATRC);\n                    this.moveTween({attr: this.MATR});\n                }\n            }else{\n                this.moving = false;\n                this.complete();\n                if(now>this.MST)this.complete = noop;\n            }\n        }\n    };\n    Animate.prototype.nextPose = function(){\n        var now=Date.now()-this.MST;\n        for(var i in this.MATR){\n            this[i] = JC.TWEEN[this.fx]( now , this.MATRC[i] , this.MATR[i] - this.MATRC[i] , this.MAT );\n        }\n    };\n\n    JC.DisplayObject = function() {\n        Animate.call( this );\n        this.visible = true;\n        this.worldAlpha = 1;\n        this.alpha = 1;\n\n        this.scaleX = 1;\n        this.scaleY = 1;\n\n        this.skewX = 0;\n        this.skewY = 0;\n\n        this.rotation = 0;\n        this.rotationCache = 0;\n        this._sr = 0;\n        this._cr = 1;\n        \n        this.x = 0;\n        this.y = 0;\n        \n        this.pivotX = 0;\n        this.pivotY = 0;\n\n        this._mask = null;\n\n        this.parent = null;\n        this.worldTransform = new JC.Matrix();\n\n        this.renderable = false;\n\n        this._cacheAsBitmap = false;\n\n        this._cacheIsDirty = false;\n    };\n\n    JC.DisplayObject.prototype = Object.create( Animate.prototype );\n    JC.DisplayObject.prototype.constructor = JC.DisplayObject;\n\n    Object.defineProperty(JC.DisplayObject.prototype, 'mask', {\n        get: function() {\n            return this._mask;\n        },\n        set: function(value) {\n\n            if (this._mask) this._mask.isMask = false;\n            this._mask = value;\n            if (this._mask) this._mask.isMask = true;\n        }\n    });\n\n    Object.defineProperty(JC.DisplayObject.prototype, 'cacheAsBitmap', {\n\n        get: function() {\n            return this._cacheAsBitmap;\n        },\n\n        set: function(value) {\n\n            if (this._cacheAsBitmap === value) return;\n\n            if (value) {\n                this._generateCachedSprite();\n            } else {\n                this._destroyCachedSprite();\n            }\n\n            this._cacheAsBitmap = value;\n        }\n    });\n\n    JC.DisplayObject.prototype.setVal = function(vals){\n        if(vals===undefined)return;\n        for(var key in vals){\n            if(this[key]===undefined){\n                continue;\n            }else{\n                this[key] = vals[key];\n            }\n        }\n    };\n\n    JC.DisplayObject.prototype.updateTransform = function() {\n        var pt = this.parent.worldTransform;\n        var wt = this.worldTransform;\n\n        var a, b, c, d, tx, ty;\n\n        if (this.rotation % JC.PI_2) {\n            if (this.rotation !== this.rotationCache) {\n                this.rotationCache = this.rotation;\n                this._sr = Math.sin(this.rotation);\n                this._cr = Math.cos(this.rotation);\n            }\n\n            a = this._cr * this.scaleX;\n            b = this._sr * this.scaleX;\n            c = -this._sr * this.scaleY;\n            d = this._cr * this.scaleY;\n            tx = this.x;\n            ty = this.y;\n\n            if (this.pivotX || this.pivotY) {\n                tx -= this.pivotX * a + this.pivotY * c;\n                ty -= this.pivotX * b + this.pivotY * d;\n            }\n\n            wt.a = a * pt.a + b * pt.c;\n            wt.b = a * pt.b + b * pt.d;\n            wt.c = c * pt.a + d * pt.c;\n            wt.d = c * pt.b + d * pt.d;\n            wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n            wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n\n\n        } else {\n            a = this.scaleX;\n            d = this.scaleY;\n\n            tx = this.x - this.pivotX * a;\n            ty = this.y - this.pivotY * d;\n\n            wt.a = a * pt.a;\n            wt.b = a * pt.b;\n            wt.c = d * pt.c;\n            wt.d = d * pt.d;\n            wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n            wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n        }\n\n        this.worldAlpha = this.alpha * this.parent.worldAlpha;\n\n        this.manager();\n    };\n\n    JC.DisplayObject.prototype.displayObjectUpdateTransform = JC.DisplayObject.prototype.updateTransform;\n\n    JC.DisplayObject.prototype.render = function(renderSession) {\n        // OVERWRITE;\n        // this line is just here to pass jshinting :)\n        renderSession = renderSession;\n    };\n\n\n\n    JC.DisplayObjectContainer = function() {\n        JC.DisplayObject.call(this);\n\n        this.children = [];\n    };\n\n    JC.DisplayObjectContainer.prototype = Object.create(JC.DisplayObject.prototype);\n    JC.DisplayObjectContainer.prototype.constructor = JC.DisplayObjectContainer;\n\n    JC.DisplayObjectContainer.prototype.addChilds = function() {\n        var l = arguments.length;\n        if(l>0){\n            for(var i=0;i<l;i++){\n                this.addChildAt(arguments[i], this.children.length);\n            }\n            return arguments[l-1];\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.addChildAt = function(child, index) {\n        if (index >= 0 && index <= this.children.length) {\n            if (child.parent) {\n                child.parent.removeChild(child);\n            }\n\n            child.parent = this;\n\n            this.children.splice(index, 0, child);\n\n            return child;\n        } else {\n            throw new Error(child + 'addChildAt: The index ' + index + ' supplied is out of bounds ' + this.children.length);\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.swapChildren = function(child, child2) {\n        if (child === child2) {\n            return;\n        }\n\n        var index1 = this.getChildIndex(child);\n        var index2 = this.getChildIndex(child2);\n\n        if (index1 < 0 || index2 < 0) {\n            throw new Error('swapChildren: Both the supplied DisplayObjects must be a child of the caller.');\n        }\n\n        this.children[index1] = child2;\n        this.children[index2] = child;\n\n    };\n\n    JC.DisplayObjectContainer.prototype.getChildIndex = function(child) {\n        var index = this.children.indexOf(child);\n        if (index === -1) {\n            throw new Error('The supplied DisplayObject must be a child of the caller');\n        }\n        return index;\n    };\n\n    JC.DisplayObjectContainer.prototype.setChildIndex = function(child, index) {\n        if (index < 0 || index >= this.children.length) {\n            throw new Error('The supplied index is out of bounds');\n        }\n        var currentIndex = this.getChildIndex(child);\n        this.children.splice(currentIndex, 1); //remove from old position\n        this.children.splice(index, 0, child); //add at new position\n    };\n\n    JC.DisplayObjectContainer.prototype.getChildAt = function(index) {\n        if (index < 0 || index >= this.children.length) {\n            throw new Error('getChildAt: Supplied index ' + index + ' does not exist in the child list, or the supplied DisplayObject must be a child of the caller');\n        }\n        return this.children[index];\n\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChild = function(child) {\n        var index = this.children.indexOf(child);\n        if (index === -1) return;\n\n        return this.removeChildAt(index);\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChildAt = function(index) {\n        var child = this.getChildAt(index);\n        if (this.stage)\n            child.removeStageReference();\n\n        child.parent = undefined;\n        this.children.splice(index, 1);\n        return child;\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChildren = function(beginIndex, endIndex) {\n        var begin = beginIndex || 0;\n        var end = typeof endIndex === 'number' ? endIndex : this.children.length;\n        var range = end - begin;\n\n        if (range > 0 && range <= end) {\n            var removed = this.children.splice(begin, range);\n            for (var i = 0; i < removed.length; i++) {\n                var child = removed[i];\n                if (this.stage)\n                    child.removeStageReference();\n                child.parent = undefined;\n            }\n            return removed;\n        } else if (range === 0 && this.children.length === 0) {\n            return [];\n        } else {\n            throw new Error('removeChildren: Range Error, numeric values are outside the acceptable range');\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.updateTransform = function() {\n        if (!this.visible) return;\n\n        this.displayObjectUpdateTransform();\n\n        for (var i = 0, j = this.children.length; i < j; i++) {\n            this.children[i].updateTransform();\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform = JC.DisplayObjectContainer.prototype.updateTransform;\n\n    JC.DisplayObjectContainer.prototype.render = function(renderSession) {\n        if (!this.visible || this.alpha <= 0) return;\n\n        if (this._cacheAsBitmap) {\n            this._renderCachedSprite(renderSession);\n            return;\n        }\n\n        var i, j;\n\n        if (this._mask) {\n\n            if (this._mask) {\n                renderSession.maskManager.pushMask(this.mask, renderSession);\n            }\n\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n            if (this._mask) renderSession.maskManager.popMask(this._mask, renderSession);\n\n        } else {\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n        }\n    };\n\n\n\n\n    JC.Sprite = function(opts) {\n        JC.DisplayObjectContainer.call(this);\n\n        this.texture = opts.texture;\n\n        this.width = opts.width||this.texture.width;\n\n        this.height = opts.height||this.texture.height;\n\n        this.sH = opts.sH||0;\n\n        this.sW = opts.sW||0;\n\n        this.tint = opts.tint||0xFFFFFF;\n\n        this.blendMode = opts.blendModes||JC.blendModes.ALPHA;\n\n        this.shader = null;\n\n        this.repeatX = opts.repeatX||false;\n        this.repeatY = opts.repeatY||false;\n\n        this.renderable = true;\n\n        this.buildMesh();\n\n    };\n\n    JC.Sprite.prototype = Object.create(JC.DisplayObjectContainer.prototype);\n    JC.Sprite.prototype.constructor = JC.Sprite;\n\n\n    JC.Sprite.prototype.buildMesh = function() {\n        var w = this.texture.width,\n            h = this.texture.height;\n        this.vertices = new JC.Float32Array([\n                -this.width/2,this.height/2,\n                -this.width/2,-this.height/2,\n                this.width/2,-this.height/2,\n                this.width/2,this.height/2\n            ]);\n        this.indices = new JC.Uint16Array([\n                0,1,2,\n                0,2,3\n            ]);\n        if(this.repeatX || this.repeatY){\n            var rX = this.repeatX?2:1,\n                rY = this.repeatY?2:1;\n            this.uvs = new JC.Float32Array([\n                0*rX, 0*rY,\n                0*rX, 1*rY,\n                1*rX, 1*rY,\n                1*rX, 0*rY\n            ]);\n        }else{\n            this.uvs = new JC.Float32Array([\n                this.sW/w, this.sH/h,\n                this.sW/w, (this.sH+this.height)/h,\n                (this.sW+this.width)/w, (this.sH+this.height)/h,\n                (this.sW+this.width)/w, this.sH/h\n            ]);\n        }\n        this.cachedTint = JC.hex2rgb(this.tint);\n        this.dirty = true;\n    };\n    \n    JC.Sprite.prototype.createBuffer = function(gl){\n        this.vertexBuffer = gl.createBuffer();\n        this.uvsBuffer = gl.createBuffer();\n        this.indicesBuffer = gl.createBuffer();\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.vertices, gl.DYNAMIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.uvsBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.uvs, gl.DYNAMIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices, gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n        this.dirty = false;\n    };\n\n    JC.Sprite.prototype.syncUniforms = function(renderSession){\n        var gl = renderSession.gl,\n            shader = renderSession.shaderManager.shader,\n            projection = renderSession.projection;\n\n        gl.uniform1i(shader.uSampler, 0);\n        gl.uniform1f(shader.uAlpha, this.worldAlpha);\n        gl.uniform2f(shader.projectionVector, projection.x, projection.y);\n        gl.uniformMatrix3fv(shader.uMatrix, false, this.worldTransform.toArray(true));\n        gl.uniform3fv(shader.uTint, this.cachedTint);\n\n    };\n\n    JC.Sprite.prototype.syncAttribute = function(renderSession){\n        var gl = renderSession.gl,\n            shader = renderSession.shaderManager.shader;\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n        gl.enableVertexAttribArray(shader.aVertexPosition);\n        gl.vertexAttribPointer(shader.aVertexPosition, 2, gl.FLOAT, false, 0, 0);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.uvsBuffer);\n        gl.enableVertexAttribArray(shader.aTextureCoord);\n        gl.vertexAttribPointer(shader.aTextureCoord, 2, gl.FLOAT, false, 0, 0);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n    };\n\n    JC.Sprite.prototype.upDate = function(renderSession) {\n        renderSession.texturesManager.setTexture(this.texture);\n        renderSession.blendModeManager.setBlendMode(this.blendMode);\n        this.dirty&&this.createBuffer(renderSession.gl);\n        this.syncAttribute(renderSession);\n        this.syncUniforms(renderSession);\n    };\n\n    JC.Sprite.prototype.render = function(renderSession) {\n        if (!this.visible || this.alpha <= 0) return;\n        this.upDate(renderSession);\n        var i, j, gl = renderSession.gl;\n\n        // do a quick check to see if this element has a mask or a filter.\n        if (this._mask) {\n\n            if (this._mask) {\n                renderSession.maskManager.pushMask(this.mask, renderSession);\n            }\n\n            // add this sprite to the batch\n            gl.drawElements(gl.TRIANGLES, this.indices.length, gl.UNSIGNED_SHORT, 0);\n\n            // now loop through the children and make sure they get rendered\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n            // time to stop the sprite batch as either a mask element or a filter draw will happen next\n\n            if (this._mask) renderSession.maskManager.popMask(this._mask, renderSession);\n        } else {\n\n            gl.drawElements(gl.TRIANGLES, this.indices.length, gl.UNSIGNED_SHORT, 0);\n\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n        }\n    };\n\n    JC.Sprite.fromFrame = function(frameId) {\n        var texture = JC.TextureCache[frameId];\n        if (!texture) throw new Error('The frameId \"' + frameId + '\" does not exist in the texture cache' + this);\n        return new JC.Sprite(texture);\n    };\n\n    JC.Sprite.fromImage = function(imageId, crossorigin, scaleMode) {\n        var texture = JC.Texture.fromImage(imageId, crossorigin, scaleMode);\n        return new JC.Sprite(texture);\n    };\n\n\n\n\n    JC.Stage = function(backgroundColor) {\n        JC.DisplayObjectContainer.call(this);\n\n        this.worldTransform = new JC.Matrix();\n\n        this.stage = this;\n\n        this.setBackgroundColor(backgroundColor);\n    };\n\n    JC.Stage.prototype = Object.create(JC.DisplayObjectContainer.prototype);\n    JC.Stage.prototype.constructor = JC.Stage;\n\n    JC.Stage.prototype.updateTransform = function() {\n        this.worldAlpha = 1;\n\n        for (var i = 0, j = this.children.length; i < j; i++) {\n            this.children[i].updateTransform();\n        }\n    };\n\n    JC.Stage.prototype.setBackgroundColor = function(bgc) {\n        if (typeof bgc === 'number') return;\n        this.backgroundColor = JC.hex2rgb(bgc);\n    };\n\n\n\n    JC.hex2rgb = function(hex) {\n        return [(hex >> 16 & 0xFF) / 255, (hex >> 8 & 0xFF) / 255, (hex & 0xFF) / 255];\n    };\n\n    JC.rgb2hex = function(rgb) {\n        return ((rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255);\n    };\n\n    /**\n     * A polyfill for Function.prototype.bind\n     *\n     * @method bind\n     */\n    if (typeof Function.prototype.bind !== 'function') {\n        Function.prototype.bind = (function() {\n            return function(thisArg) {\n                var target = this,\n                    i = arguments.length - 1,\n                    boundArgs = [];\n                if (i > 0) {\n                    boundArgs.length = i;\n                    while (i--) boundArgs[i] = arguments[i + 1];\n                }\n\n                if (typeof target !== 'function') throw new TypeError();\n\n                function bound() {\n                    var i = arguments.length,\n                        args = new Array(i);\n                    while (i--) args[i] = arguments[i];\n                    args = boundArgs.concat(args);\n                    return target.apply(this instanceof bound ? this : thisArg, args);\n                }\n\n                bound.prototype = (function F(proto) {\n                    if (proto) F.prototype = proto;\n                    if (!(this instanceof F)) return new F();\n                })(target.prototype);\n\n                return bound;\n            };\n        })();\n    }\n\n    JC.getNextPowerOfTwo = function(number) {\n        if (number > 0 && (number & (number - 1)) === 0) // see: http://goo.gl/D9kPj\n            return number;\n        else {\n            var result = 1;\n            while (result < number) result <<= 1;\n            return result;\n        }\n    };\n\n    JC.isPowerOfTwo = function(width, height) {\n        return (width > 0 && (width & (width - 1)) === 0 && height > 0 && (height & (height - 1)) === 0);\n\n    };\n\n\n\n    JC.CompileVertexShader = function(gl, shaderSrc) {\n        return JC._CompileShader(gl, shaderSrc, gl.VERTEX_SHADER);\n    };\n\n    JC.CompileFragmentShader = function(gl, shaderSrc) {\n        return JC._CompileShader(gl, shaderSrc, gl.FRAGMENT_SHADER);\n    };\n\n    JC._CompileShader = function(gl, shaderSrc, shaderType) {\n        var src = shaderSrc.join(\"\\n\");\n        var shader = gl.createShader(shaderType);\n        gl.shaderSource(shader, src);\n        gl.compileShader(shader);\n\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            window.console.log(gl.getShaderInfoLog(shader));\n            return null;\n        }\n\n        return shader;\n    };\n\n    JC.compileProgram = function(gl, vertexSrc, fragmentSrc) {\n        var fragmentShader = JC.CompileFragmentShader(gl, fragmentSrc);\n        var vertexShader = JC.CompileVertexShader(gl, vertexSrc);\n\n        var shaderProgram = gl.createProgram();\n\n        gl.attachShader(shaderProgram, vertexShader);\n        gl.attachShader(shaderProgram, fragmentShader);\n        gl.linkProgram(shaderProgram);\n\n        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n            window.console.log(\"Could not initialise shaders\");\n        }\n\n        return shaderProgram;\n    };\n\n\n\n    JC.SpriteShader = function(gl) {\n        this.gl = gl;\n\n        this.program = null;\n\n        this.fragmentSrc = [\n            'precision lowp float;',\n            'varying vec2 vTextureCoord;',\n\n            'uniform sampler2D uSampler;',\n            'uniform vec3 uTint;',\n            'uniform float uAlpha;',\n\n            'void main(void) {',\n            '   vec4 smpColor = texture2D(uSampler, vTextureCoord);',\n            '   gl_FragColor = vec4(uTint,uAlpha) * smpColor;',\n            '}'\n        ];\n\n        this.vertexSrc = [\n            'attribute vec2 aVertexPosition;',\n            'attribute vec2 aTextureCoord;',\n\n            'uniform vec2 projectionVector;',\n            'uniform mat3 uMatrix;',\n\n            'varying vec2 vTextureCoord;',\n\n            'void main(void) {',\n            '   vec2 v = ( uMatrix * vec3(aVertexPosition , 1.0) ).xy ;',\n            '   gl_Position = vec4( v / projectionVector , 0.0, 1.0);',\n            '   vTextureCoord = aTextureCoord;',\n            '}'\n        ];\n\n        this.textureCount = 0;\n\n        this.init();\n    };\n\n    JC.SpriteShader.prototype.constructor = JC.SpriteShader;\n\n    JC.SpriteShader.prototype.init = function() {\n        var gl = this.gl;\n\n        var program = JC.compileProgram(gl, this.vertexSrc, this.fragmentSrc);\n\n        gl.useProgram(program);\n\n        this.uSampler = gl.getUniformLocation(program, 'uSampler');\n        this.projectionVector = gl.getUniformLocation(program, 'projectionVector');\n        this.uMatrix = gl.getUniformLocation(program, 'uMatrix');\n        this.uTint = gl.getUniformLocation(program, 'uTint');\n        this.uAlpha = gl.getUniformLocation(program, 'uAlpha');\n\n        this.aVertexPosition = gl.getAttribLocation(program, 'aVertexPosition');\n        this.aTextureCoord = gl.getAttribLocation(program, 'aTextureCoord');\n\n        this.program = program;\n    };\n\n    JC.SpriteShader.prototype.destroy = function() {\n        this.gl.deleteProgram(this.program);\n        this.gl = null;\n    };\n\n\n\n    JC.Renderer = function(width, height, options) {\n        if (options) {\n            for (var i in JC.defaultRenderOptions) {\n                if (typeof options[i] === 'undefined') options[i] = JC.defaultRenderOptions[i];\n            }\n        } else {\n            options = JC.defaultRenderOptions;\n        }\n\n        JC.sayHello();\n\n        this.resolution = options.resolution || window.devicePixelRatio;\n\n        this.transparent = options.transparent;\n\n        this.autoResize = options.autoResize || false;\n\n        this.clearBeforeRender = options.clearBeforeRender || true;\n\n        this.width = width || 800;\n\n        this.height = height || 600;\n\n        this.view = options.view || document.createElement('canvas');\n\n        this.contextLostBound = this.handleContextLost.bind(this);\n\n        this.contextRestoredBound = this.handleContextRestored.bind(this);\n\n        this.view.addEventListener('webglcontextlost', this.contextLostBound, false);\n        this.view.addEventListener('webglcontextrestored', this.contextRestoredBound, false);\n\n        this._contextOptions = {\n            alpha: this.transparent,\n            antialias: options.antialias, // SPEED UP??\n            premultipliedAlpha: this.transparent && this.transparent !== 'notMultiplied',\n            stencil: true,\n            preserveDrawingBuffer: options.preserveDrawingBuffer\n        };\n\n        this.projection = new JC.Point();\n\n        this.offset = new JC.Point(0, 0);\n\n        this.shaderManager = new JC.ShaderManager();\n\n        this.texturesManager = new JC.TexturesManager();\n\n        this.maskManager = new JC.WebGLMaskManager();\n\n        this.blendModeManager = new JC.WebGLBlendModeManager();\n\n        this.renderSession = {};\n        this.renderSession.gl = this.gl;\n        this.renderSession.shaderManager = this.shaderManager;\n        this.renderSession.texturesManager = this.texturesManager;\n        this.renderSession.maskManager = this.maskManager;\n        this.renderSession.blendModeManager = this.blendModeManager;\n        this.renderSession.renderer = this;\n        this.renderSession.resolution = this.resolution;\n\n        // time init the context..\n        this.initContext();\n\n        // map some webGL blend modes..\n        this.mapBlendModes();\n    };\n\n    JC.Renderer.prototype.constructor = JC.Renderer;\n\n    JC.Renderer.prototype.initContext = function() {\n        var gl = this.view.getContext('webgl', this._contextOptions) || this.view.getContext('experimental-webgl', this._contextOptions);\n        this.gl = gl;\n\n        if (!gl) {\n            throw new Error('This browser does not support webGL. Try using the canvas renderer');\n        }\n\n        // set up the default JC settings..\n        gl.disable(gl.DEPTH_TEST);\n        gl.disable(gl.CULL_FACE);\n        gl.enable(gl.BLEND);\n\n        // need to set the context for all the managers...\n        this.shaderManager.setContext(gl);\n        this.texturesManager.setContext(gl);\n        this.maskManager.setContext(gl);\n        this.blendModeManager.setContext(gl);\n\n        this.renderSession.gl = this.gl;\n\n        // now resize and we are good to go!\n        this.resize(this.width, this.height);\n\n    };\n\n    JC.Renderer.prototype.render = function(stage) {\n        // no point rendering if our context has been blown up!\n        if (this.contextLost) return;\n\n        // update the scene graph\n        stage.updateTransform();\n\n        var gl = this.gl;\n\n        // make sure we are bound to the main frame buffer\n        // gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        if (this.clearBeforeRender) {\n            if (this.transparent) {\n                gl.clearColor(0, 0, 0, 0);\n            } else {\n                gl.clearColor(stage.backgroundColor[0], stage.backgroundColor[1], stage.backgroundColor[2], 1);\n            }\n\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n\n        this.renderDisplayObject(stage, this.projection);\n    };\n\n    JC.Renderer.prototype.renderDisplayObject = function(displayObject, projection, buffer) {\n        this.renderSession.blendModeManager.setBlendMode(JC.blendModes.ALPHA);\n\n        // set the default projection\n        this.renderSession.projection = projection;\n\n        //set the default offset\n        this.renderSession.offset = this.offset;\n\n        // render the scene!\n        displayObject.render(this.renderSession);\n\n    };\n\n    JC.Renderer.prototype.resize = function(width, height) {\n        this.width = width * this.resolution;\n        this.height = height * this.resolution;\n\n        this.view.width = this.width;\n        this.view.height = this.height;\n\n        if (this.autoResize) {\n            this.view.style.width = this.width / this.resolution + 'px';\n            this.view.style.height = this.height / this.resolution + 'px';\n        }\n\n        this.gl.viewport(0, 0, this.width, this.height);\n\n        this.projection.x = this.width / 2 / this.resolution;\n        this.projection.y = this.height / 2 / this.resolution;\n    };\n\n    JC.Renderer.prototype.handleContextLost = function(event) {\n        event.preventDefault();\n        this.contextLost = true;\n    };\n\n    JC.Renderer.prototype.handleContextRestored = function() {\n        this.initContext();\n\n        this.contextLost = false;\n    };\n\n    JC.Renderer.prototype.mapBlendModes = function() {\n        var gl = this.gl;\n\n        if (!JC.blendModesWebGL) {\n            JC.blendModesWebGL = [];\n\n            JC.blendModesWebGL[JC.blendModes.NORMAL]      = [gl.ONE, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.ALPHA]       = [gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.ADD]         = [gl.SRC_ALPHA, gl.DST_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.MULTIPLY]    = [gl.DST_COLOR, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.SCREEN]      = [gl.SRC_ALPHA, gl.ONE];\n        }\n    };\n\n\n\n\n\n    JC.TexturesManager = function() {\n        this.textures = {};\n    };\n\n    JC.TexturesManager.prototype.constructor = JC.TexturesManager;\n\n    JC.TexturesManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.TexturesManager.prototype.setTexture = function(texture) {\n        var gl = this.gl;\n        if (this.currentId === texture.id) return false;\n\n        if(this.textures[texture.id]===undefined){\n            this.setPara(texture);\n        }\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.textures[texture.id].texture);\n        \n        this.currentId = texture.id;\n\n        return true;\n    };\n\n    JC.TexturesManager.prototype.setPara = function(texture) {\n        var gl = this.gl;\n\n        texture.texture = gl.createTexture();\n\n        // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture.texture);\n        \n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.img);\n        \n        if(texture.isPowerOfTwo)gl.generateMipmap(gl.TEXTURE_2D);\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n        this.textures[texture.id] = texture;\n\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    };\n\n    JC.TexturesManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n\n\n    JC.WebGLBlendModeManager = function() {\n        this.currentBlendMode = 99999;\n    };\n\n    JC.WebGLBlendModeManager.prototype.constructor = JC.WebGLBlendModeManager;\n\n    JC.WebGLBlendModeManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.WebGLBlendModeManager.prototype.setBlendMode = function(blendMode) {\n        if (this.currentBlendMode === blendMode) return false;\n\n        this.currentBlendMode = blendMode;\n\n        var blendModeWebGL = JC.blendModesWebGL[this.currentBlendMode];\n        \n        this.gl.blendEquation( this.gl.FUNC_ADD );\n        this.gl.blendFunc(blendModeWebGL[0], blendModeWebGL[1]);\n\n        return true;\n    };\n\n    JC.WebGLBlendModeManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n    JC.ShaderManager = function()\n    {\n\n        this.shaders = {};\n\n    };\n\n    JC.ShaderManager.prototype.constructor = JC.ShaderManager;\n\n    JC.ShaderManager.prototype.setContext = function(gl)\n    {\n        this.gl = gl;\n\n        // this shader is used for the default sprite rendering\n        this.shaders['sprite'] = new JC.SpriteShader(gl);\n\n        this.setShader('sprite');\n    };\n\n\n    JC.ShaderManager.prototype.setShader = function(type)\n    {\n        if(this._curShaderType === type)return false;\n        \n        this._curShaderType = type;\n\n        this.shader = this.shaders[type];\n\n        this.gl.useProgram(this.shader.program);\n\n        return true;\n    };\n\n    JC.ShaderManager.prototype.destroy = function()\n    {\n        this.gl = null;\n    };\n\n\n\n\n    JC.WebGLMaskManager = function() {};\n\n    JC.WebGLMaskManager.prototype.constructor = JC.WebGLMaskManager;\n\n    JC.WebGLMaskManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.WebGLMaskManager.prototype.pushMask = function(maskData, renderSession) {\n        var gl = renderSession.gl;\n\n\n        gl.enable(gl.STENCIL_TEST);\n        gl.depthMask(false);\n        gl.colorMask(false, false, false, false);\n        gl.stencilFunc(gl.ALWAYS, 1, ~0);\n        gl.stencilOp(gl.KEEP, gl.REPLACE, gl.REPLACE);\n\n        // maskData.render();\n\n        gl.depthMask(true);\n        gl.colorMask(true, true, true, true);\n        gl.stencilFunc(gl.EQUAL, 1, ~0);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n    };\n\n    JC.WebGLMaskManager.prototype.popMask = function() {\n        var gl = this.gl;\n        gl.disable(gl.STENCIL_TEST);\n    };\n\n    JC.WebGLMaskManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n    /**\n     * @author Mat Groves http://matgroves.com/ @Doormat23\n     */\n\n    if (typeof exports !== 'undefined') {\n        if (typeof module !== 'undefined' && module.exports) {\n            exports = module.exports = JC;\n        }\n        exports.JC = JC;\n    } else if (typeof define !== 'undefined' && define.amd) {\n        define(JC);\n    } else {\n        root.JC = JC;\n    }\n\n})(this);\n","(function(){\n    window.JC = window.JC||{};\n    JC.Texture = function(id, img)\n    {\n        this.id = id;\n        this.img = img;\n        this.width = img.width;\n        this.height = img.height;\n        this.isPowerOfTwo = JC.isPowerOfTwo(this.width,this.height);\n    };\n\n\n    JC.TextureUvs = function()\n    {\n        this.x0 = 0;\n        this.y0 = 0;\n\n        this.x1 = 0;\n        this.y1 = 0;\n\n        this.x2 = 0;\n        this.y2 = 0;\n\n        this.x3 = 0;\n        this.y3 = 0;\n    };\n\n\n\n    JC.TextureCache = {};\n\n\n    JC.ImageLoader = function(sources, crossorigin){\n        this.receiveNum = 0;\n        this.failNum = 0;\n        this.requestNum = 0;\n        this.crossorigin = crossorigin;\n        this.sources = sources||{};\n        this.imgs = {};\n\n        this.loading();\n    };\n    JC.ImageLoader.prototype.constructor = JC.ImageLoader;\n    JC.ImageLoader.prototype.loading = function(){\n        var This = this;\n\n        function ears(source,img){\n            img.onload = function(){\n                This.receiveNum++;\n                JC.TextureCache[source] = new JC.Texture(source,img);\n                if((This.receiveNum+This.failNum)>=This.requestNum){\n                    This.onLoaded();\n                    This.failNum>0&&This.onFailed();\n                }\n            };\n            img.onerror = function (){\n                This.failNum++;\n            };\n        }\n\n        for(var source in this.sources){\n            this.imgs[source] = new Image();\n\n            ears(source,this.imgs[source]);\n\n            if(this.crossorigin){\n                this.imgs[source].crossOrigin = '';\n            }\n            this.imgs[source].src = this.sources[source];\n            this.requestNum++;\n        }\n    };\n    JC.ImageLoader.prototype.getTexture = function(id){\n        return JC.TextureCache[id];\n    };\n    JC.ImageLoader.prototype.onLoaded = function(){};\n    JC.ImageLoader.prototype.onFailed = function(){};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n})();","(function() {\n\n\twindow.JC = window.JC||{};\n\n\tJC.TWEEN = {\n\t\teaseBoth: function(t, b, c, d){  //加速减速曲线\n\t\t\tif ((t/=d/2) < 1) {\n\t\t\t\treturn c/2*t*t + b;\n\t\t\t}\n\t\t\treturn -c/2 * ((--t)*(t-2) - 1) + b;\n\t\t},\n\t\textend: function(opts){\n\t\t\tif(!opts)return;\n\t\t\tfor(var key in opts){\n\t\t\t\tif(key!=='extend'&&opts[key])this[key]=opts[key];\n\t\t\t}\n\t\t}\n\t};\n\n})();"]}