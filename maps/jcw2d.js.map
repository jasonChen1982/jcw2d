{"version":3,"sources":["RAF.js","jcw2d.js","texture.js","tween.js"],"names":["lastTime","vendors","x","length","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","RAF","requestAnimFrame","noop","Animate","this","MST","MAT","fx","complete","moving","infinity","alternate","repeats","root","JC","VERSION","blendModes","NORMAL","ALPHA","ADD","MULTIPLY","SCREEN","scaleModes","DEFAULT","LINEAR","NEAREST","Float32Array","Uint16Array","Uint32Array","ArrayBuffer","Array","console","log","PI_2","PI","RTD","DTR","dontSpeek","defaultRenderOptions","view","transparent","antialias","preserveDrawingBuffer","resolution","clearBeforeRender","autoResize","sayHello","type","navigator","userAgent","toLowerCase","indexOf","args","apply","Point","y","prototype","clone","set","constructor","Matrix","a","b","c","d","tx","ty","fromArray","array","toArray","transpose","pos","newPos","applyInverse","translate","scale","rotate","angle","cos","sin","a1","c1","tx1","append","matrix","b1","d1","identity","identityMatrix","moveTween","opts","now","MATR","attr","time","MATRC","i","manager","nextPose","setVal","TWEEN","DisplayObject","call","visible","worldAlpha","alpha","scaleX","scaleY","skewX","skewY","rotation","rotationCache","_sr","_cr","pivotX","pivotY","_mask","parent","worldTransform","renderable","_cacheAsBitmap","_cacheIsDirty","Object","create","defineProperty","get","value","isMask","_generateCachedSprite","_destroyCachedSprite","vals","undefined","key","updateTransform","pt","wt","displayObjectUpdateTransform","render","renderSession","DisplayObjectContainer","children","addChild","child","addChildAt","index","removeChild","splice","Error","swapChildren","child2","index1","getChildIndex","index2","setChildIndex","currentIndex","getChildAt","removeChildAt","stage","removeStageReference","removeChildren","beginIndex","endIndex","begin","end","range","removed","j","displayObjectContainerUpdateTransform","_renderCachedSprite","maskManager","pushMask","mask","popMask","Sprite","texture","width","height","sH","sW","tint","blendMode","shader","repeatX","repeatY","buildMesh","w","h","vertices","indices","rX","rY","uvs","cachedTint","hex2rgb","dirty","createBuffer","gl","vertexBuffer","uvsBuffer","indicesBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","syncUniforms","shaderManager","projection","uniform1i","uSampler","uniform1f","uAlpha","uniform2f","projectionVector","uniformMatrix3fv","uMatrix","uniform3fv","uTint","syncAttribute","enableVertexAttribArray","aVertexPosition","vertexAttribPointer","FLOAT","aTextureCoord","upDate","texturesManager","setTexture","blendModeManager","setBlendMode","drawElements","TRIANGLES","UNSIGNED_SHORT","fromFrame","frameId","TextureCache","fromImage","imageId","crossorigin","scaleMode","Texture","Stage","backgroundColor","setBackgroundColor","bgc","hex","rgb2hex","rgb","Function","bind","thisArg","bound","arguments","boundArgs","concat","target","TypeError","F","proto","getNextPowerOfTwo","number","result","isPowerOfTwo","CompileVertexShader","shaderSrc","_CompileShader","VERTEX_SHADER","CompileFragmentShader","FRAGMENT_SHADER","shaderType","src","join","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","compileProgram","vertexSrc","fragmentSrc","fragmentShader","vertexShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","SpriteShader","program","textureCount","init","useProgram","getUniformLocation","getAttribLocation","destroy","deleteProgram","Renderer","options","devicePixelRatio","document","createElement","contextLostBound","handleContextLost","contextRestoredBound","handleContextRestored","addEventListener","_contextOptions","premultipliedAlpha","stencil","offset","ShaderManager","TexturesManager","WebGLMaskManager","WebGLBlendModeManager","renderer","initContext","mapBlendModes","getContext","disable","DEPTH_TEST","CULL_FACE","enable","BLEND","setContext","resize","contextLost","clearColor","clear","COLOR_BUFFER_BIT","renderDisplayObject","displayObject","buffer","style","viewport","event","preventDefault","baseTexture","_glTextures","blendModesWebGL","ONE","ONE_MINUS_SRC_ALPHA","SRC_ALPHA","DST_ALPHA","DST_COLOR","textures","currentId","setPara","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","img","generateMipmap","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","currentBlendMode","blendModeWebGL","blendFunc","shaders","setShader","_curShaderType","maskData","STENCIL_TEST","depthMask","colorMask","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","EQUAL","exports","module","define","amd","TextureUvs","x0","y0","x1","y1","x2","y2","x3","y3","ImageLoader","sources","receiveNum","failNum","requestNum","imgs","loading","ears","source","onload","This","onLoaded","onFailed","onerror","Image","crossOrigin","getTexture","easeBoth","t","extend"],"mappings":"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","file":"../modules/jcw2d.js","sourcesContent":["(function() {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n            window[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n\n    if (!window.requestAnimationFrame) {\n        window.requestAnimationFrame = function(callback) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); },\n              timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n    }\n\n    if (!window.cancelAnimationFrame) {\n        window.cancelAnimationFrame = function(id) {\n            clearTimeout(id);\n        };\n    }\n\n    window.RAF = window.requestAnimFrame = window.requestAnimationFrame;\n})();","(function() {\n\n    var root = this;\n\n    var JC = JC || {};\n\n    JC.VERSION = \"v0.0.3\";\n\n    JC.blendModes = {\n        NORMAL: 0,\n        ALPHA: 1,\n        ADD: 2,\n        MULTIPLY: 3,\n        SCREEN: 4\n    };\n\n    JC.scaleModes = {\n        DEFAULT: 0,\n        LINEAR: 0,\n        NEAREST: 1\n    };\n\n    if (typeof(Float32Array) != 'undefined') {\n        JC.Float32Array = Float32Array;\n        JC.Uint16Array = Uint16Array;\n\n        JC.Uint32Array = Uint32Array;\n        JC.ArrayBuffer = ArrayBuffer;\n    } else {\n        JC.Float32Array = Array;\n        JC.Uint16Array = Array;\n\n        JC.Uint32Array = Array;\n        JC.ArrayBuffer = Array;\n        console.log('%c not type array ', 'color: #fff;background: #f00;');\n    }\n\n    JC.PI_2 = Math.PI * 2;\n\n    JC.RTD = 180 / Math.PI;\n\n    JC.DTR = Math.PI / 180;\n\n    JC.dontSpeek = false;\n\n    JC.defaultRenderOptions = {\n        view: null,\n        transparent: false,\n        antialias: false,\n        preserveDrawingBuffer: false,\n        resolution: 1,\n        clearBeforeRender: true,\n        autoResize: false\n    };\n\n    function noop(){}\n\n    JC.sayHello = function(type) {\n        if (JC.dontSpeek) return;\n\n        if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {\n            var args = [\n                '%c  %c jcw2d.js ' + JC.VERSION + '  %c ' + ' %c ' + ' http://www.jason82.com/ %c  ',\n                'background: #80a89e',\n                'color: #f98165; background: #cad9d5;',\n                'background: #80a89e',\n                'background: #cad9d5',\n                'background: #80a89e'\n            ];\n\n            console.log.apply(console, args);\n        }else{\n            console.log(' jcw2d.js ' + JC.VERSION + '  http://www.jason82.com/  ');\n        }\n\n        JC.dontSpeek = true;\n    };\n\n\n    JC.Point = function(x, y) {\n        this.x = x || 0;\n\n        this.y = y || 0;\n    };\n    JC.Point.prototype.clone = function() {\n        return new JC.Point(this.x, this.y);\n    };\n    JC.Point.prototype.set = function(x, y) {\n        this.x = x || 0;\n        this.y = y || ((y !== 0) ? this.x : 0);\n    };\n    JC.Point.prototype.constructor = JC.Point;\n\n\n    JC.Matrix = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n    };\n    JC.Matrix.prototype.fromArray = function(array) {\n        this.a = array[0];\n        this.b = array[1];\n        this.c = array[3];\n        this.d = array[4];\n        this.tx = array[2];\n        this.ty = array[5];\n    };\n    JC.Matrix.prototype.toArray = function(transpose) {\n        if (!this.array) this.array = new JC.Float32Array(9);\n        var array = this.array;\n\n        if (transpose) {\n            array[0] = this.a;\n            array[1] = this.b;\n            array[2] = 0;\n            array[3] = this.c;\n            array[4] = this.d;\n            array[5] = 0;\n            array[6] = this.tx;\n            array[7] = this.ty;\n            array[8] = 1;\n        } else {\n            array[0] = this.a;\n            array[1] = this.c;\n            array[2] = this.tx;\n            array[3] = this.b;\n            array[4] = this.d;\n            array[5] = this.ty;\n            array[6] = 0;\n            array[7] = 0;\n            array[8] = 1;\n        }\n\n        return array;\n    };\n    JC.Matrix.prototype.apply = function(pos, newPos) {\n        newPos = newPos || new JC.Point();\n\n        newPos.x = this.a * pos.x + this.c * pos.y + this.tx;\n        newPos.y = this.b * pos.x + this.d * pos.y + this.ty;\n\n        return newPos;\n    };\n    JC.Matrix.prototype.applyInverse = function(pos, newPos) {\n        newPos = newPos || new JC.Point();\n\n        var id = 1 / (this.a * this.d + this.c * -this.b);\n\n        newPos.x = this.d * id * pos.x + -this.c * id * pos.y + (this.ty * this.c - this.tx * this.d) * id;\n        newPos.y = this.a * id * pos.y + -this.b * id * pos.x + (-this.ty * this.a + this.tx * this.b) * id;\n\n        return newPos;\n    };\n    JC.Matrix.prototype.translate = function(x, y) {\n        this.tx += x;\n        this.ty += y;\n\n        return this;\n    };\n    JC.Matrix.prototype.scale = function(x, y) {\n        this.a *= x;\n        this.d *= y;\n        this.c *= x;\n        this.b *= y;\n        this.tx *= x;\n        this.ty *= y;\n\n        return this;\n    };\n    JC.Matrix.prototype.rotate = function(angle) {\n        var cos = Math.cos(angle);\n        var sin = Math.sin(angle);\n\n        var a1 = this.a;\n        var c1 = this.c;\n        var tx1 = this.tx;\n\n        this.a = a1 * cos - this.b * sin;\n        this.b = a1 * sin + this.b * cos;\n        this.c = c1 * cos - this.d * sin;\n        this.d = c1 * sin + this.d * cos;\n        this.tx = tx1 * cos - this.ty * sin;\n        this.ty = tx1 * sin + this.ty * cos;\n\n        return this;\n    };\n    JC.Matrix.prototype.append = function(matrix) {\n        var a1 = this.a;\n        var b1 = this.b;\n        var c1 = this.c;\n        var d1 = this.d;\n\n        this.a = matrix.a * a1 + matrix.b * c1;\n        this.b = matrix.a * b1 + matrix.b * d1;\n        this.c = matrix.c * a1 + matrix.d * c1;\n        this.d = matrix.c * b1 + matrix.d * d1;\n\n        this.tx = matrix.tx * a1 + matrix.ty * c1 + this.tx;\n        this.ty = matrix.tx * b1 + matrix.ty * d1 + this.ty;\n\n        return this;\n    };\n    JC.Matrix.prototype.identity = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n\n        return this;\n    };\n\n    JC.identityMatrix = new JC.Matrix();\n\n\n    function Animate(){\n        this.MST = 0;\n        this.MAT = 300;\n        this.fx = 'easeBoth';\n        this.complete = noop;\n        this.moving = false;\n        this.infinity = false;\n        this.alternate = false;\n        this.repeats = 0;\n    }\n    Animate.prototype.moveTween = function(opts){\n        this.MST = Date.now();\n        this.MATR = opts.attr||this.MATR;\n        this.MAT = opts.time||this.MAT;\n        this.fx = opts.fx||this.fx;\n        this.complete = opts.complete||this.complete;\n        this.infinity = opts.infinity||this.infinity;\n        this.alternate = opts.alternate||this.alternate;\n        this.repeats = opts.repeats||this.repeats;\n        this.moving = true;\n        this.MATRC = {};\n        for(var i in this.MATR){\n            this.MATRC[i] = this[i];\n        }\n    };\n    Animate.prototype.manager = function(){\n        if(!this.moving)return;\n        var now = Date.now();\n        if(now < this.MST+this.MAT){\n            this.nextPose();\n        }else{\n            this.setVal(this.MATR);\n            if(this.repeats>0||this.infinity){\n                this.repeats>0&&--this.repeats;\n                if(this.alternate){\n                    this.moveTween({attr: this.MATRC});\n                }else{\n                    this.setVal(this.MATRC);\n                    this.moveTween({attr: this.MATR});\n                }\n            }else{\n                this.moving = false;\n                this.complete();\n                if(now>this.MST)this.complete = noop;\n            }\n        }\n    };\n    Animate.prototype.nextPose = function(){\n        var now=Date.now()-this.MST;\n        for(var i in this.MATR){\n            this[i] = JC.TWEEN[this.fx]( now , this.MATRC[i] , this.MATR[i] - this.MATRC[i] , this.MAT );\n        }\n    };\n\n    JC.DisplayObject = function() {\n        Animate.call( this );\n        this.visible = true;\n        this.worldAlpha = 1;\n        this.alpha = 1;\n\n        this.scaleX = 1;\n        this.scaleY = 1;\n\n        this.skewX = 0;\n        this.skewY = 0;\n\n        this.rotation = 0;\n        this.rotationCache = 0;\n        this._sr = 0;\n        this._cr = 1;\n        \n        this.x = 0;\n        this.y = 0;\n        \n        this.pivotX = 0;\n        this.pivotY = 0;\n\n        this._mask = null;\n\n        this.parent = null;\n        this.worldTransform = new JC.Matrix();\n\n        this.renderable = false;\n\n        this._cacheAsBitmap = false;\n\n        this._cacheIsDirty = false;\n    };\n\n    JC.DisplayObject.prototype = Object.create( Animate.prototype );\n    JC.DisplayObject.prototype.constructor = JC.DisplayObject;\n\n    Object.defineProperty(JC.DisplayObject.prototype, 'mask', {\n        get: function() {\n            return this._mask;\n        },\n        set: function(value) {\n\n            if (this._mask) this._mask.isMask = false;\n            this._mask = value;\n            if (this._mask) this._mask.isMask = true;\n        }\n    });\n\n    Object.defineProperty(JC.DisplayObject.prototype, 'cacheAsBitmap', {\n\n        get: function() {\n            return this._cacheAsBitmap;\n        },\n\n        set: function(value) {\n\n            if (this._cacheAsBitmap === value) return;\n\n            if (value) {\n                this._generateCachedSprite();\n            } else {\n                this._destroyCachedSprite();\n            }\n\n            this._cacheAsBitmap = value;\n        }\n    });\n\n    JC.DisplayObject.prototype.setVal = function(vals){\n        if(vals===undefined)return;\n        for(var key in vals){\n            if(this[key]===undefined){\n                continue;\n            }else{\n                this[key] = vals[key];\n            }\n        }\n    };\n\n    JC.DisplayObject.prototype.updateTransform = function() {\n        var pt = this.parent.worldTransform;\n        var wt = this.worldTransform;\n\n        var a, b, c, d, tx, ty;\n\n        if (this.rotation % JC.PI_2) {\n            if (this.rotation !== this.rotationCache) {\n                this.rotationCache = this.rotation;\n                this._sr = Math.sin(this.rotation);\n                this._cr = Math.cos(this.rotation);\n            }\n\n            a = this._cr * this.scaleX;\n            b = this._sr * this.scaleX;\n            c = -this._sr * this.scaleY;\n            d = this._cr * this.scaleY;\n            tx = this.x;\n            ty = this.y;\n\n            if (this.pivotX || this.pivotY) {\n                tx -= this.pivotX * a + this.pivotY * c;\n                ty -= this.pivotX * b + this.pivotY * d;\n            }\n\n            wt.a = a * pt.a + b * pt.c;\n            wt.b = a * pt.b + b * pt.d;\n            wt.c = c * pt.a + d * pt.c;\n            wt.d = c * pt.b + d * pt.d;\n            wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n            wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n\n\n        } else {\n            a = this.scaleX;\n            d = this.scaleY;\n\n            tx = this.x - this.pivotX * a;\n            ty = this.y - this.pivotY * d;\n\n            wt.a = a * pt.a;\n            wt.b = a * pt.b;\n            wt.c = d * pt.c;\n            wt.d = d * pt.d;\n            wt.tx = tx * pt.a + ty * pt.c + pt.tx;\n            wt.ty = tx * pt.b + ty * pt.d + pt.ty;\n        }\n\n        this.worldAlpha = this.alpha * this.parent.worldAlpha;\n\n        this.manager();\n    };\n\n    JC.DisplayObject.prototype.displayObjectUpdateTransform = JC.DisplayObject.prototype.updateTransform;\n\n    JC.DisplayObject.prototype.render = function(renderSession) {\n        // OVERWRITE;\n        // this line is just here to pass jshinting :)\n        renderSession = renderSession;\n    };\n\n\n\n    JC.DisplayObjectContainer = function() {\n        JC.DisplayObject.call(this);\n\n        this.children = [];\n    };\n\n    JC.DisplayObjectContainer.prototype = Object.create(JC.DisplayObject.prototype);\n    JC.DisplayObjectContainer.prototype.constructor = JC.DisplayObjectContainer;\n\n    JC.DisplayObjectContainer.prototype.addChild = function(child) {\n        return this.addChildAt(child, this.children.length);\n    };\n\n    JC.DisplayObjectContainer.prototype.addChildAt = function(child, index) {\n        if (index >= 0 && index <= this.children.length) {\n            if (child.parent) {\n                child.parent.removeChild(child);\n            }\n\n            child.parent = this;\n\n            this.children.splice(index, 0, child);\n\n            return child;\n        } else {\n            throw new Error(child + 'addChildAt: The index ' + index + ' supplied is out of bounds ' + this.children.length);\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.swapChildren = function(child, child2) {\n        if (child === child2) {\n            return;\n        }\n\n        var index1 = this.getChildIndex(child);\n        var index2 = this.getChildIndex(child2);\n\n        if (index1 < 0 || index2 < 0) {\n            throw new Error('swapChildren: Both the supplied DisplayObjects must be a child of the caller.');\n        }\n\n        this.children[index1] = child2;\n        this.children[index2] = child;\n\n    };\n\n    JC.DisplayObjectContainer.prototype.getChildIndex = function(child) {\n        var index = this.children.indexOf(child);\n        if (index === -1) {\n            throw new Error('The supplied DisplayObject must be a child of the caller');\n        }\n        return index;\n    };\n\n    JC.DisplayObjectContainer.prototype.setChildIndex = function(child, index) {\n        if (index < 0 || index >= this.children.length) {\n            throw new Error('The supplied index is out of bounds');\n        }\n        var currentIndex = this.getChildIndex(child);\n        this.children.splice(currentIndex, 1); //remove from old position\n        this.children.splice(index, 0, child); //add at new position\n    };\n\n    JC.DisplayObjectContainer.prototype.getChildAt = function(index) {\n        if (index < 0 || index >= this.children.length) {\n            throw new Error('getChildAt: Supplied index ' + index + ' does not exist in the child list, or the supplied DisplayObject must be a child of the caller');\n        }\n        return this.children[index];\n\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChild = function(child) {\n        var index = this.children.indexOf(child);\n        if (index === -1) return;\n\n        return this.removeChildAt(index);\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChildAt = function(index) {\n        var child = this.getChildAt(index);\n        if (this.stage)\n            child.removeStageReference();\n\n        child.parent = undefined;\n        this.children.splice(index, 1);\n        return child;\n    };\n\n    JC.DisplayObjectContainer.prototype.removeChildren = function(beginIndex, endIndex) {\n        var begin = beginIndex || 0;\n        var end = typeof endIndex === 'number' ? endIndex : this.children.length;\n        var range = end - begin;\n\n        if (range > 0 && range <= end) {\n            var removed = this.children.splice(begin, range);\n            for (var i = 0; i < removed.length; i++) {\n                var child = removed[i];\n                if (this.stage)\n                    child.removeStageReference();\n                child.parent = undefined;\n            }\n            return removed;\n        } else if (range === 0 && this.children.length === 0) {\n            return [];\n        } else {\n            throw new Error('removeChildren: Range Error, numeric values are outside the acceptable range');\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.updateTransform = function() {\n        if (!this.visible) return;\n\n        this.displayObjectUpdateTransform();\n\n        for (var i = 0, j = this.children.length; i < j; i++) {\n            this.children[i].updateTransform();\n        }\n    };\n\n    JC.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform = JC.DisplayObjectContainer.prototype.updateTransform;\n\n    JC.DisplayObjectContainer.prototype.render = function(renderSession) {\n        if (!this.visible || this.alpha <= 0) return;\n\n        if (this._cacheAsBitmap) {\n            this._renderCachedSprite(renderSession);\n            return;\n        }\n\n        var i, j;\n\n        if (this._mask) {\n\n            if (this._mask) {\n                renderSession.maskManager.pushMask(this.mask, renderSession);\n            }\n\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n            if (this._mask) renderSession.maskManager.popMask(this._mask, renderSession);\n\n        } else {\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n        }\n    };\n\n\n\n\n    JC.Sprite = function(opts) {\n        JC.DisplayObjectContainer.call(this);\n\n        this.texture = opts.texture;\n\n        this.width = opts.width||this.texture.width;\n\n        this.height = opts.height||this.texture.height;\n\n        this.sH = opts.sH||0;\n\n        this.sW = opts.sW||0;\n\n        this.tint = opts.tint||0xFFFFFF;\n\n        this.blendMode = opts.blendModes||JC.blendModes.ALPHA;\n\n        this.shader = null;\n\n        this.repeatX = opts.repeatX||false;\n        this.repeatY = opts.repeatY||false;\n\n        this.renderable = true;\n\n        this.buildMesh();\n\n    };\n\n    JC.Sprite.prototype = Object.create(JC.DisplayObjectContainer.prototype);\n    JC.Sprite.prototype.constructor = JC.Sprite;\n\n\n    JC.Sprite.prototype.buildMesh = function() {\n        var w = this.texture.width,\n            h = this.texture.height;\n        this.vertices = new JC.Float32Array([\n                -this.width/2,this.height/2,\n                -this.width/2,-this.height/2,\n                this.width/2,-this.height/2,\n                this.width/2,this.height/2\n            ]);\n        this.indices = new JC.Uint16Array([\n                0,1,2,\n                0,2,3\n            ]);\n        if(this.repeatX || this.repeatY){\n            var rX = this.repeatX?2:1,\n                rY = this.repeatY?2:1;\n            this.uvs = new JC.Float32Array([\n                0*rX, 0*rY,\n                0*rX, 1*rY,\n                1*rX, 1*rY,\n                1*rX, 0*rY\n            ]);\n        }else{\n            this.uvs = new JC.Float32Array([\n                this.sW/w, this.sH/h,\n                this.sW/w, (this.sH+this.height)/h,\n                (this.sW+this.width)/w, (this.sH+this.height)/h,\n                (this.sW+this.width)/w, this.sH/h\n            ]);\n        }\n        this.cachedTint = JC.hex2rgb(this.tint);\n        this.dirty = true;\n    };\n    \n    JC.Sprite.prototype.createBuffer = function(gl){\n        this.vertexBuffer = gl.createBuffer();\n        this.uvsBuffer = gl.createBuffer();\n        this.indicesBuffer = gl.createBuffer();\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.vertices, gl.DYNAMIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.uvsBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, this.uvs, gl.DYNAMIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices, gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n        this.dirty = false;\n    };\n\n    JC.Sprite.prototype.syncUniforms = function(renderSession){\n        var gl = renderSession.gl,\n            shader = renderSession.shaderManager.shader,\n            projection = renderSession.projection;\n\n        gl.uniform1i(shader.uSampler, 0);\n        gl.uniform1f(shader.uAlpha, this.worldAlpha);\n        gl.uniform2f(shader.projectionVector, projection.x, projection.y);\n        gl.uniformMatrix3fv(shader.uMatrix, false, this.worldTransform.toArray(true));\n        gl.uniform3fv(shader.uTint, this.cachedTint);\n\n    };\n\n    JC.Sprite.prototype.syncAttribute = function(renderSession){\n        var gl = renderSession.gl,\n            shader = renderSession.shaderManager.shader;\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n        gl.enableVertexAttribArray(shader.aVertexPosition);\n        gl.vertexAttribPointer(shader.aVertexPosition, 2, gl.FLOAT, false, 0, 0);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.uvsBuffer);\n        gl.enableVertexAttribArray(shader.aTextureCoord);\n        gl.vertexAttribPointer(shader.aTextureCoord, 2, gl.FLOAT, false, 0, 0);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n    };\n\n    JC.Sprite.prototype.upDate = function(renderSession) {\n        renderSession.texturesManager.setTexture(this.texture);\n        renderSession.blendModeManager.setBlendMode(this.blendMode);\n        this.dirty&&this.createBuffer(renderSession.gl);\n        this.syncAttribute(renderSession);\n        this.syncUniforms(renderSession);\n    };\n\n    JC.Sprite.prototype.render = function(renderSession) {\n        if (!this.visible || this.alpha <= 0) return;\n        this.upDate(renderSession);\n        var i, j, gl = renderSession.gl;\n\n        // do a quick check to see if this element has a mask or a filter.\n        if (this._mask) {\n\n            if (this._mask) {\n                renderSession.maskManager.pushMask(this.mask, renderSession);\n            }\n\n            // add this sprite to the batch\n            gl.drawElements(gl.TRIANGLES, this.indices.length, gl.UNSIGNED_SHORT, 0);\n\n            // now loop through the children and make sure they get rendered\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n            // time to stop the sprite batch as either a mask element or a filter draw will happen next\n\n            if (this._mask) renderSession.maskManager.popMask(this._mask, renderSession);\n        } else {\n\n            gl.drawElements(gl.TRIANGLES, this.indices.length, gl.UNSIGNED_SHORT, 0);\n\n            // simple render children!\n            for (i = 0, j = this.children.length; i < j; i++) {\n                this.children[i].render(renderSession);\n            }\n\n        }\n    };\n\n    JC.Sprite.fromFrame = function(frameId) {\n        var texture = JC.TextureCache[frameId];\n        if (!texture) throw new Error('The frameId \"' + frameId + '\" does not exist in the texture cache' + this);\n        return new JC.Sprite(texture);\n    };\n\n    JC.Sprite.fromImage = function(imageId, crossorigin, scaleMode) {\n        var texture = JC.Texture.fromImage(imageId, crossorigin, scaleMode);\n        return new JC.Sprite(texture);\n    };\n\n\n\n\n    JC.Stage = function(backgroundColor) {\n        JC.DisplayObjectContainer.call(this);\n\n        this.worldTransform = new JC.Matrix();\n\n        this.stage = this;\n\n        this.setBackgroundColor(backgroundColor);\n    };\n\n    JC.Stage.prototype = Object.create(JC.DisplayObjectContainer.prototype);\n    JC.Stage.prototype.constructor = JC.Stage;\n\n    JC.Stage.prototype.updateTransform = function() {\n        this.worldAlpha = 1;\n\n        for (var i = 0, j = this.children.length; i < j; i++) {\n            this.children[i].updateTransform();\n        }\n    };\n\n    JC.Stage.prototype.setBackgroundColor = function(bgc) {\n        if (typeof bgc === 'number') return;\n        this.backgroundColor = JC.hex2rgb(bgc);\n    };\n\n\n\n    JC.hex2rgb = function(hex) {\n        return [(hex >> 16 & 0xFF) / 255, (hex >> 8 & 0xFF) / 255, (hex & 0xFF) / 255];\n    };\n\n    JC.rgb2hex = function(rgb) {\n        return ((rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255);\n    };\n\n    /**\n     * A polyfill for Function.prototype.bind\n     *\n     * @method bind\n     */\n    if (typeof Function.prototype.bind !== 'function') {\n        Function.prototype.bind = (function() {\n            return function(thisArg) {\n                var target = this,\n                    i = arguments.length - 1,\n                    boundArgs = [];\n                if (i > 0) {\n                    boundArgs.length = i;\n                    while (i--) boundArgs[i] = arguments[i + 1];\n                }\n\n                if (typeof target !== 'function') throw new TypeError();\n\n                function bound() {\n                    var i = arguments.length,\n                        args = new Array(i);\n                    while (i--) args[i] = arguments[i];\n                    args = boundArgs.concat(args);\n                    return target.apply(this instanceof bound ? this : thisArg, args);\n                }\n\n                bound.prototype = (function F(proto) {\n                    if (proto) F.prototype = proto;\n                    if (!(this instanceof F)) return new F();\n                })(target.prototype);\n\n                return bound;\n            };\n        })();\n    }\n\n    JC.getNextPowerOfTwo = function(number) {\n        if (number > 0 && (number & (number - 1)) === 0) // see: http://goo.gl/D9kPj\n            return number;\n        else {\n            var result = 1;\n            while (result < number) result <<= 1;\n            return result;\n        }\n    };\n\n    JC.isPowerOfTwo = function(width, height) {\n        return (width > 0 && (width & (width - 1)) === 0 && height > 0 && (height & (height - 1)) === 0);\n\n    };\n\n\n\n    JC.CompileVertexShader = function(gl, shaderSrc) {\n        return JC._CompileShader(gl, shaderSrc, gl.VERTEX_SHADER);\n    };\n\n    JC.CompileFragmentShader = function(gl, shaderSrc) {\n        return JC._CompileShader(gl, shaderSrc, gl.FRAGMENT_SHADER);\n    };\n\n    JC._CompileShader = function(gl, shaderSrc, shaderType) {\n        var src = shaderSrc.join(\"\\n\");\n        var shader = gl.createShader(shaderType);\n        gl.shaderSource(shader, src);\n        gl.compileShader(shader);\n\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            window.console.log(gl.getShaderInfoLog(shader));\n            return null;\n        }\n\n        return shader;\n    };\n\n    JC.compileProgram = function(gl, vertexSrc, fragmentSrc) {\n        var fragmentShader = JC.CompileFragmentShader(gl, fragmentSrc);\n        var vertexShader = JC.CompileVertexShader(gl, vertexSrc);\n\n        var shaderProgram = gl.createProgram();\n\n        gl.attachShader(shaderProgram, vertexShader);\n        gl.attachShader(shaderProgram, fragmentShader);\n        gl.linkProgram(shaderProgram);\n\n        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n            window.console.log(\"Could not initialise shaders\");\n        }\n\n        return shaderProgram;\n    };\n\n\n\n    JC.SpriteShader = function(gl) {\n        this.gl = gl;\n\n        this.program = null;\n\n        this.fragmentSrc = [\n            'precision lowp float;',\n            'varying vec2 vTextureCoord;',\n\n            'uniform sampler2D uSampler;',\n            'uniform vec3 uTint;',\n            'uniform float uAlpha;',\n\n            'void main(void) {',\n            '   vec4 smpColor = texture2D(uSampler, vTextureCoord);',\n            '   gl_FragColor = vec4(uTint,uAlpha) * smpColor;',\n            '}'\n        ];\n\n        this.vertexSrc = [\n            'attribute vec2 aVertexPosition;',\n            'attribute vec2 aTextureCoord;',\n\n            'uniform vec2 projectionVector;',\n            'uniform mat3 uMatrix;',\n\n            'varying vec2 vTextureCoord;',\n\n            'void main(void) {',\n            '   vec2 v = ( uMatrix * vec3(aVertexPosition , 1.0) ).xy ;',\n            '   gl_Position = vec4( v / projectionVector , 0.0, 1.0);',\n            '   vTextureCoord = aTextureCoord;',\n            '}'\n        ];\n\n        this.textureCount = 0;\n\n        this.init();\n    };\n\n    JC.SpriteShader.prototype.constructor = JC.SpriteShader;\n\n    JC.SpriteShader.prototype.init = function() {\n        var gl = this.gl;\n\n        var program = JC.compileProgram(gl, this.vertexSrc, this.fragmentSrc);\n\n        gl.useProgram(program);\n\n        this.uSampler = gl.getUniformLocation(program, 'uSampler');\n        this.projectionVector = gl.getUniformLocation(program, 'projectionVector');\n        this.uMatrix = gl.getUniformLocation(program, 'uMatrix');\n        this.uTint = gl.getUniformLocation(program, 'uTint');\n        this.uAlpha = gl.getUniformLocation(program, 'uAlpha');\n\n        this.aVertexPosition = gl.getAttribLocation(program, 'aVertexPosition');\n        this.aTextureCoord = gl.getAttribLocation(program, 'aTextureCoord');\n\n        this.program = program;\n    };\n\n    JC.SpriteShader.prototype.destroy = function() {\n        this.gl.deleteProgram(this.program);\n        this.gl = null;\n    };\n\n\n\n    JC.Renderer = function(width, height, options) {\n        if (options) {\n            for (var i in JC.defaultRenderOptions) {\n                if (typeof options[i] === 'undefined') options[i] = JC.defaultRenderOptions[i];\n            }\n        } else {\n            options = JC.defaultRenderOptions;\n        }\n\n        JC.sayHello();\n\n        this.resolution = options.resolution || window.devicePixelRatio;\n\n        this.transparent = options.transparent;\n\n        this.autoResize = options.autoResize || false;\n\n        this.clearBeforeRender = options.clearBeforeRender || true;\n\n        this.width = width || 800;\n\n        this.height = height || 600;\n\n        this.view = options.view || document.createElement('canvas');\n\n        this.contextLostBound = this.handleContextLost.bind(this);\n\n        this.contextRestoredBound = this.handleContextRestored.bind(this);\n\n        this.view.addEventListener('webglcontextlost', this.contextLostBound, false);\n        this.view.addEventListener('webglcontextrestored', this.contextRestoredBound, false);\n\n        this._contextOptions = {\n            alpha: this.transparent,\n            antialias: options.antialias, // SPEED UP??\n            premultipliedAlpha: this.transparent && this.transparent !== 'notMultiplied',\n            stencil: true,\n            preserveDrawingBuffer: options.preserveDrawingBuffer\n        };\n\n        this.projection = new JC.Point();\n\n        this.offset = new JC.Point(0, 0);\n\n        this.shaderManager = new JC.ShaderManager();\n\n        this.texturesManager = new JC.TexturesManager();\n\n        this.maskManager = new JC.WebGLMaskManager();\n\n        this.blendModeManager = new JC.WebGLBlendModeManager();\n\n        this.renderSession = {};\n        this.renderSession.gl = this.gl;\n        this.renderSession.shaderManager = this.shaderManager;\n        this.renderSession.texturesManager = this.texturesManager;\n        this.renderSession.maskManager = this.maskManager;\n        this.renderSession.blendModeManager = this.blendModeManager;\n        this.renderSession.renderer = this;\n        this.renderSession.resolution = this.resolution;\n\n        // time init the context..\n        this.initContext();\n\n        // map some webGL blend modes..\n        this.mapBlendModes();\n    };\n\n    JC.Renderer.prototype.constructor = JC.Renderer;\n\n    JC.Renderer.prototype.initContext = function() {\n        var gl = this.view.getContext('webgl', this._contextOptions) || this.view.getContext('experimental-webgl', this._contextOptions);\n        this.gl = gl;\n\n        if (!gl) {\n            throw new Error('This browser does not support webGL. Try using the canvas renderer');\n        }\n\n        // set up the default JC settings..\n        gl.disable(gl.DEPTH_TEST);\n        gl.disable(gl.CULL_FACE);\n        gl.enable(gl.BLEND);\n\n        // need to set the context for all the managers...\n        this.shaderManager.setContext(gl);\n        this.texturesManager.setContext(gl);\n        this.maskManager.setContext(gl);\n        this.blendModeManager.setContext(gl);\n\n        this.renderSession.gl = this.gl;\n\n        // now resize and we are good to go!\n        this.resize(this.width, this.height);\n\n    };\n\n    JC.Renderer.prototype.render = function(stage) {\n        // no point rendering if our context has been blown up!\n        if (this.contextLost) return;\n\n        // update the scene graph\n        stage.updateTransform();\n\n        var gl = this.gl;\n\n        // make sure we are bound to the main frame buffer\n        // gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        if (this.clearBeforeRender) {\n            if (this.transparent) {\n                gl.clearColor(0, 0, 0, 0);\n            } else {\n                gl.clearColor(stage.backgroundColor[0], stage.backgroundColor[1], stage.backgroundColor[2], 1);\n            }\n\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n\n        this.renderDisplayObject(stage, this.projection);\n    };\n\n    JC.Renderer.prototype.renderDisplayObject = function(displayObject, projection, buffer) {\n        this.renderSession.blendModeManager.setBlendMode(JC.blendModes.ALPHA);\n\n        // set the default projection\n        this.renderSession.projection = projection;\n\n        //set the default offset\n        this.renderSession.offset = this.offset;\n\n        // render the scene!\n        displayObject.render(this.renderSession);\n\n    };\n\n    JC.Renderer.prototype.resize = function(width, height) {\n        this.width = width * this.resolution;\n        this.height = height * this.resolution;\n\n        this.view.width = this.width;\n        this.view.height = this.height;\n\n        if (this.autoResize) {\n            this.view.style.width = this.width / this.resolution + 'px';\n            this.view.style.height = this.height / this.resolution + 'px';\n        }\n\n        this.gl.viewport(0, 0, this.width, this.height);\n\n        this.projection.x = this.width / 2 / this.resolution;\n        this.projection.y = this.height / 2 / this.resolution;\n    };\n\n    JC.Renderer.prototype.handleContextLost = function(event) {\n        event.preventDefault();\n        this.contextLost = true;\n    };\n\n    JC.Renderer.prototype.handleContextRestored = function() {\n        this.initContext();\n\n        for (var key in JC.TextureCache) {\n            var texture = JC.TextureCache[key].baseTexture;\n            texture._glTextures = [];\n        }\n\n        this.contextLost = false;\n    };\n\n    JC.Renderer.prototype.mapBlendModes = function() {\n        var gl = this.gl;\n\n        if (!JC.blendModesWebGL) {\n            JC.blendModesWebGL = [];\n\n            JC.blendModesWebGL[JC.blendModes.NORMAL]      = [gl.ONE, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.ALPHA]       = [gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.ADD]         = [gl.SRC_ALPHA, gl.DST_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.MULTIPLY]    = [gl.DST_COLOR, gl.ONE_MINUS_SRC_ALPHA];\n            JC.blendModesWebGL[JC.blendModes.SCREEN]      = [gl.SRC_ALPHA, gl.ONE];\n        }\n    };\n\n\n\n\n\n    JC.TexturesManager = function() {\n        this.textures = {};\n    };\n\n    JC.TexturesManager.prototype.constructor = JC.TexturesManager;\n\n    JC.TexturesManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.TexturesManager.prototype.setTexture = function(texture) {\n        var gl = this.gl;\n        if (this.currentId === texture.id) return false;\n\n        if(this.textures[texture.id]===undefined){\n            this.setPara(texture);\n        }\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.textures[texture.id].texture);\n        \n        this.currentId = texture.id;\n\n        return true;\n    };\n\n    JC.TexturesManager.prototype.setPara = function(texture) {\n        var gl = this.gl;\n\n        texture.texture = gl.createTexture();\n\n        // gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture.texture);\n        \n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.img);\n        \n        if(texture.isPowerOfTwo)gl.generateMipmap(gl.TEXTURE_2D);\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n        this.textures[texture.id] = texture;\n\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    };\n\n    JC.TexturesManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n\n\n    JC.WebGLBlendModeManager = function() {\n        this.currentBlendMode = 99999;\n    };\n\n    JC.WebGLBlendModeManager.prototype.constructor = JC.WebGLBlendModeManager;\n\n    JC.WebGLBlendModeManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.WebGLBlendModeManager.prototype.setBlendMode = function(blendMode) {\n        if (this.currentBlendMode === blendMode) return false;\n\n        this.currentBlendMode = blendMode;\n\n        var blendModeWebGL = JC.blendModesWebGL[this.currentBlendMode];\n        this.gl.blendFunc(blendModeWebGL[0], blendModeWebGL[1]);\n\n        return true;\n    };\n\n    JC.WebGLBlendModeManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n    JC.ShaderManager = function()\n    {\n\n        this.shaders = {};\n\n    };\n\n    JC.ShaderManager.prototype.constructor = JC.ShaderManager;\n\n    JC.ShaderManager.prototype.setContext = function(gl)\n    {\n        this.gl = gl;\n\n        // this shader is used for the default sprite rendering\n        this.shaders['sprite'] = new JC.SpriteShader(gl);\n\n        this.setShader('sprite');\n    };\n\n\n    JC.ShaderManager.prototype.setShader = function(type)\n    {\n        if(this._curShaderType === type)return false;\n        \n        this._curShaderType = type;\n\n        this.shader = this.shaders[type];\n\n        this.gl.useProgram(this.shader.program);\n\n        return true;\n    };\n\n    JC.ShaderManager.prototype.destroy = function()\n    {\n        this.gl = null;\n    };\n\n\n\n\n    JC.WebGLMaskManager = function() {};\n\n    JC.WebGLMaskManager.prototype.constructor = JC.WebGLMaskManager;\n\n    JC.WebGLMaskManager.prototype.setContext = function(gl) {\n        this.gl = gl;\n    };\n\n    JC.WebGLMaskManager.prototype.pushMask = function(maskData, renderSession) {\n        var gl = renderSession.gl;\n\n\n        gl.enable(gl.STENCIL_TEST);\n        gl.depthMask(false);\n        gl.colorMask(false, false, false, false);\n        gl.stencilFunc(gl.ALWAYS, 1, ~0);\n        gl.stencilOp(gl.KEEP, gl.REPLACE, gl.REPLACE);\n\n        // maskData.render();\n\n        gl.depthMask(true);\n        gl.colorMask(true, true, true, true);\n        gl.stencilFunc(gl.EQUAL, 1, ~0);\n        gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n    };\n\n    JC.WebGLMaskManager.prototype.popMask = function() {\n        var gl = this.gl;\n        gl.disable(gl.STENCIL_TEST);\n    };\n\n    JC.WebGLMaskManager.prototype.destroy = function() {\n        this.gl = null;\n    };\n\n\n    /**\n     * @author Mat Groves http://matgroves.com/ @Doormat23\n     */\n\n    if (typeof exports !== 'undefined') {\n        if (typeof module !== 'undefined' && module.exports) {\n            exports = module.exports = JC;\n        }\n        exports.JC = JC;\n    } else if (typeof define !== 'undefined' && define.amd) {\n        define(JC);\n    } else {\n        root.JC = JC;\n    }\n\n})(this);\n","(function(){\n    window.JC = window.JC||{};\n    JC.Texture = function(id, img)\n    {\n        this.id = id;\n        this.img = img;\n        this.width = img.width;\n        this.height = img.height;\n        this.isPowerOfTwo = JC.isPowerOfTwo(this.width,this.height);\n    };\n\n\n    JC.TextureUvs = function()\n    {\n        this.x0 = 0;\n        this.y0 = 0;\n\n        this.x1 = 0;\n        this.y1 = 0;\n\n        this.x2 = 0;\n        this.y2 = 0;\n\n        this.x3 = 0;\n        this.y3 = 0;\n    };\n\n\n\n    JC.TextureCache = {};\n\n\n    JC.ImageLoader = function(sources, crossorigin){\n        this.receiveNum = 0;\n        this.failNum = 0;\n        this.requestNum = 0;\n        this.crossorigin = crossorigin;\n        this.sources = sources||{};\n        this.imgs = {};\n\n        this.loading();\n    };\n    JC.ImageLoader.prototype.constructor = JC.ImageLoader;\n    JC.ImageLoader.prototype.loading = function(){\n        var This = this;\n\n        function ears(source,img){\n            img.onload = function(){\n                This.receiveNum++;\n                JC.TextureCache[source] = new JC.Texture(source,img);\n                if((This.receiveNum+This.failNum)>=This.requestNum){\n                    This.onLoaded();\n                    This.failNum>0&&This.onFailed();\n                }\n            };\n            img.onerror = function (){\n                This.failNum++;\n            };\n        }\n\n        for(var source in this.sources){\n            this.imgs[source] = new Image();\n\n            ears(source,this.imgs[source]);\n\n            if(this.crossorigin){\n                this.imgs[source].crossOrigin = '';\n            }\n            this.imgs[source].src = this.sources[source];\n            this.requestNum++;\n        }\n    };\n    JC.ImageLoader.prototype.getTexture = function(id){\n        return JC.TextureCache[id];\n    };\n    JC.ImageLoader.prototype.onLoaded = function(){};\n    JC.ImageLoader.prototype.onFailed = function(){};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n})();","(function() {\n\n\twindow.JC = window.JC||{};\n\n\tJC.TWEEN = {\n\t\teaseBoth: function(t, b, c, d){  //加速减速曲线\n\t\t\tif ((t/=d/2) < 1) {\n\t\t\t\treturn c/2*t*t + b;\n\t\t\t}\n\t\t\treturn -c/2 * ((--t)*(t-2) - 1) + b;\n\t\t},\n\t\textend: function(opts){\n\t\t\tif(!opts)return;\n\t\t\tfor(var key in opts){\n\t\t\t\tif(key!=='extend'&&opts[key])this[key]=opts[key];\n\t\t\t}\n\t\t}\n\t};\n\n})();"]}